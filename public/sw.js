const q=_=>_?typeof _=='string'||typeof _=='number'?new Date(_):_:new Date,$=_=>(_=q(_),Math.floor(new Date(_.toUTCString()).getTime())),ee=_=>(_=q(_),new Date(_.getTime()-_.getTimezoneOffset())),J=(_,n)=>new Date($(_)+n);var F=(_=>(_.Info='info',_.Debug='debug',_.Warning='warning',_.Error='error',_.Success='success',_))(F||{});const te=(_,n,o)=>{switch(n){case F.Info:o?console.info(_,o):console.info(_);break;case F.Debug:o?console.debug(_,o):console.debug(_);break;case F.Warning:o?console.warn(_,o):console.warn(_);break;case F.Error:o?console.error(_,o):console.error(_);break;case F.Success:o?console.info(_,o):console.info(_);break;default:o?console.log(_,o):console.log(_);}},re=(_,n)=>{te(_,F.Debug,n);},ie={recommendedMaxHoursPerTask:8,workingHoursPerDay:8,estimateMultiplier:2,defaultActivityDurationInDays:7,defaultEventDurationInMinutes:60,calendar:{syncIntervalMinutes:15,syncProxyServer:'https://rodjo.bluebanana.hr/?calendar_url=',snapDifference:6e5}};var R=(_=>(_.NoRepeat='',_.Daily='daily',_.Weekly='weekly',_.Monthly='monthly',_.Yearly='yearly',_.Custom='custom',_))(R||{}),Z=(_=>(_.Task='task',_.Event='event',_.Project='project',_.New='new',_))(Z||{});function ne(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,'default')?_.default:_;}var X={exports:{}};(function(_){var n;(function(){n=_.exports;})(),n.foldLength=75,n.newLineChar=`\r
`,n.helpers={updateTimezones:function(o){var t,e,i,r,s,a;if(!o||o.name!=='vcalendar')return o;for(t=o.getAllSubcomponents(),e=[],i={},s=0;s<t.length;s++)t[s].name==='vtimezone'?(a=t[s].getFirstProperty('tzid').getFirstValue(),i[a]=t[s]):e=e.concat(t[s].getAllProperties());for(r={},s=0;s<e.length;s++)(a=e[s].getParameter('tzid'))&&(r[a]=!0);for(s in i)i.hasOwnProperty(s)&&!r[s]&&o.removeSubcomponent(i[s]);for(s in r)r.hasOwnProperty(s)&&!i[s]&&n.TimezoneService.has(s)&&o.addSubcomponent(n.TimezoneService.get(s).component);return o;},isStrictlyNaN:function(o){return typeof o=='number'&&isNaN(o);},strictParseInt:function(o){var t=parseInt(o,10);if(n.helpers.isStrictlyNaN(t))throw new Error('Could not extract integer from "'+o+'"');return t;},formatClassType:function(t,e){if(!(typeof t>'u'))return t instanceof e?t:new e(t);},unescapedIndexOf:function(o,t,e){for(;(e=o.indexOf(t,e))!==-1;)if(e>0&&o[e-1]==='\\')e+=1;else return e;return-1;},binsearchInsert:function(o,t,e){if(!o.length)return 0;for(var i=0,r=o.length-1,s,a;i<=r;)if(s=i+Math.floor((r-i)/2),a=e(t,o[s]),a<0)r=s-1;else if(a>0)i=s+1;else break;return a<0?s:a>0?s+1:s;},dumpn:function(){n.debug&&(typeof console<'u'&&'log'in console?n.helpers.dumpn=function(t){console.log(t);}:n.helpers.dumpn=function(t){dump(t+`
`);},n.helpers.dumpn(arguments[0]));},clone:function(o,t){if(!o||typeof o!='object')return o;if(o instanceof Date)return new Date(o.getTime());if('clone'in o)return o.clone();if(Array.isArray(o)){for(var e=[],i=0;i<o.length;i++)e.push(t?n.helpers.clone(o[i],!0):o[i]);return e;}else{var r={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t?r[s]=n.helpers.clone(o[s],!0):r[s]=o[s]);return r;}},foldline:function(t){for(var e='',i=t||'',r=0,s=0;i.length;){var a=i.codePointAt(r);a<128?++s:a<2048?s+=2:a<65536?s+=3:s+=4,s<n.foldLength+1?r+=a>65535?2:1:(e+=n.newLineChar+' '+i.substring(0,r),i=i.substring(r),r=s=0);}return e.substr(n.newLineChar.length+1);},pad2:function(t){typeof t!='string'&&(typeof t=='number'&&(t=parseInt(t)),t=String(t));var e=t.length;switch(e){case 0:return'00';case 1:return'0'+t;default:return t;}},trunc:function(t){return t<0?Math.ceil(t):Math.floor(t);},inherits:function(o,t,e){function i(){}i.prototype=o.prototype,t.prototype=new i,e&&n.helpers.extend(e,t.prototype);},extend:function(o,t){for(var e in o){var i=Object.getOwnPropertyDescriptor(o,e);i&&!Object.getOwnPropertyDescriptor(t,e)&&Object.defineProperty(t,e,i);}return t;}},n.design=function(){var o=/\\\\|\\;|\\,|\\[Nn]/g,t=/\\|;|,|\n/g,e=/\\\\|\\,|\\[Nn]/g,i=/\\|,|\n/g;function r(h,g){var w={matches:/.*/,fromICAL:function(O,B){return T(O,h,B);},toICAL:function(O,B){var U=g;return B&&(U=new RegExp(U.source+'|'+B)),O.replace(U,(H) =>{switch(H){case'\\':return'\\\\';case';':return'\\;';case',':return'\\,';case`
`:return'\\n';default:return H;}});}};return w;}var s={defaultType:'text'},a={defaultType:'text',multiValue:','},u={defaultType:'text',structuredValue:';'},f={defaultType:'integer'},l={defaultType:'date-time',allowedTypes:['date-time','date']},m={defaultType:'date-time'},c={defaultType:'uri'},d={defaultType:'utc-offset'},y={defaultType:'recur'},v={defaultType:'date-and-or-time',allowedTypes:['date-time','date','text']};function p(h){switch(h){case'\\\\':return'\\';case'\\;':return';';case'\\,':return',';case'\\n':case'\\N':return`
`;default:return h;}}function T(h,g,w){return h.indexOf('\\')===-1?h:(w&&(g=new RegExp(g.source+'|\\\\'+w)),h.replace(g,p));}var b={categories:a,url:c,version:s,uid:s},Y={boolean:{values:['TRUE','FALSE'],fromICAL:function(h){switch(h){case'TRUE':return!0;case'FALSE':return!1;default:return!1;}},toICAL:function(h){return h?'TRUE':'FALSE';}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(h){var g=parseFloat(h);return n.helpers.isStrictlyNaN(g)?0:g;},toICAL:function(h){return String(h);}},integer:{fromICAL:function(h){var g=parseInt(h);return n.helpers.isStrictlyNaN(g)?0:g;},toICAL:function(h){return String(h);}},'utc-offset':{toICAL:function(h){return h.length<7?h.substr(0,3)+h.substr(4,2):h.substr(0,3)+h.substr(4,2)+h.substr(7,2);},fromICAL:function(h){return h.length<6?h.substr(0,3)+':'+h.substr(3,2):h.substr(0,3)+':'+h.substr(3,2)+':'+h.substr(5,2);},decorate:function(h){return n.UtcOffset.fromString(h);},undecorate:function(h){return h.toString();}}},A={cutype:{values:['INDIVIDUAL','GROUP','RESOURCE','ROOM','UNKNOWN'],allowXName:!0,allowIanaToken:!0},'delegated-from':{valueType:'cal-address',multiValue:',',multiValueSeparateDQuote:!0},'delegated-to':{valueType:'cal-address',multiValue:',',multiValueSeparateDQuote:!0},encoding:{values:['8BIT','BASE64']},fbtype:{values:['FREE','BUSY','BUSY-UNAVAILABLE','BUSY-TENTATIVE'],allowXName:!0,allowIanaToken:!0},member:{valueType:'cal-address',multiValue:',',multiValueSeparateDQuote:!0},partstat:{values:['NEEDS-ACTION','ACCEPTED','DECLINED','TENTATIVE','DELEGATED','COMPLETED','IN-PROCESS'],allowXName:!0,allowIanaToken:!0},range:{values:['THISANDFUTURE']},related:{values:['START','END']},reltype:{values:['PARENT','CHILD','SIBLING'],allowXName:!0,allowIanaToken:!0},role:{values:['REQ-PARTICIPANT','CHAIR','OPT-PARTICIPANT','NON-PARTICIPANT'],allowXName:!0,allowIanaToken:!0},rsvp:{values:['TRUE','FALSE']},'sent-by':{valueType:'cal-address'},tzid:{matches:/^\//},value:{values:['binary','boolean','cal-address','date','date-time','duration','float','integer','period','recur','text','time','uri','utc-offset'],allowXName:!0,allowIanaToken:!0}},D=n.helpers.extend(Y,{text:r(o,t),uri:{},binary:{decorate:function(h){return n.Binary.fromString(h);},undecorate:function(h){return h.toString();}},'cal-address':{},date:{decorate:function(h,g){return M.strict?n.Time.fromDateString(h,g):n.Time.fromString(h,g);},undecorate:function(h){return h.toString();},fromICAL:function(h){return!M.strict&&h.length>=15?D['date-time'].fromICAL(h):h.substr(0,4)+'-'+h.substr(4,2)+'-'+h.substr(6,2);},toICAL:function(h){var g=h.length;return g==10?h.substr(0,4)+h.substr(5,2)+h.substr(8,2):g>=19?D['date-time'].toICAL(h):h;}},'date-time':{fromICAL:function(h){if(!M.strict&&h.length==8)return D.date.fromICAL(h);var g=h.substr(0,4)+'-'+h.substr(4,2)+'-'+h.substr(6,2)+'T'+h.substr(9,2)+':'+h.substr(11,2)+':'+h.substr(13,2);return h[15]&&h[15]==='Z'&&(g+='Z'),g;},toICAL:function(h){var g=h.length;if(g==10&&!M.strict)return D.date.toICAL(h);if(g>=19){var w=h.substr(0,4)+h.substr(5,2)+h.substr(8,5)+h.substr(14,2)+h.substr(17,2);return h[19]&&h[19]==='Z'&&(w+='Z'),w;}else return h;},decorate:function(h,g){return M.strict?n.Time.fromDateTimeString(h,g):n.Time.fromString(h,g);},undecorate:function(h){return h.toString();}},duration:{decorate:function(h){return n.Duration.fromString(h);},undecorate:function(h){return h.toString();}},period:{fromICAL:function(h){var g=h.split('/');return g[0]=D['date-time'].fromICAL(g[0]),n.Duration.isValueString(g[1])||(g[1]=D['date-time'].fromICAL(g[1])),g;},toICAL:function(h){return!M.strict&&h[0].length==10?h[0]=D.date.toICAL(h[0]):h[0]=D['date-time'].toICAL(h[0]),n.Duration.isValueString(h[1])||(!M.strict&&h[1].length==10?h[1]=D.date.toICAL(h[1]):h[1]=D['date-time'].toICAL(h[1])),h.join('/');},decorate:function(h,g){return n.Period.fromJSON(h,g,!M.strict);},undecorate:function(h){return h.toJSON();}},recur:{fromICAL:function(h){return n.Recur._stringToData(h,!0);},toICAL:function(h){var g='';for(var w in h)if(Object.prototype.hasOwnProperty.call(h,w)){var O=h[w];w=='until'?O.length>10?O=D['date-time'].toICAL(O):O=D.date.toICAL(O):w=='wkst'?typeof O=='number'&&(O=n.Recur.numericDayToIcalDay(O)):Array.isArray(O)&&(O=O.join(',')),g+=w.toUpperCase()+'='+O+';';}return g.substr(0,g.length-1);},decorate:function(g){return n.Recur.fromData(g);},undecorate:function(h){return h.toJSON();}},time:{fromICAL:function(h){if(h.length<6)return h;var g=h.substr(0,2)+':'+h.substr(2,2)+':'+h.substr(4,2);return h[6]==='Z'&&(g+='Z'),g;},toICAL:function(h){if(h.length<8)return h;var g=h.substr(0,2)+h.substr(3,2)+h.substr(6,2);return h[8]==='Z'&&(g+='Z'),g;}}}),N=n.helpers.extend(b,{action:s,attach:{defaultType:'uri'},attendee:{defaultType:'cal-address'},calscale:s,class:s,comment:s,completed:m,contact:s,created:m,description:s,dtend:l,dtstamp:m,dtstart:l,due:l,duration:{defaultType:'duration'},exdate:{defaultType:'date-time',allowedTypes:['date-time','date'],multiValue:','},exrule:y,freebusy:{defaultType:'period',multiValue:','},geo:{defaultType:'float',structuredValue:';'},'last-modified':m,location:s,method:s,organizer:{defaultType:'cal-address'},'percent-complete':f,priority:f,prodid:s,'related-to':s,repeat:f,rdate:{defaultType:'date-time',allowedTypes:['date-time','date','period'],multiValue:',',detectType:function(h){return h.indexOf('/')!==-1?'period':h.indexOf('T')===-1?'date':'date-time';}},'recurrence-id':l,resources:a,'request-status':u,rrule:y,sequence:f,status:s,summary:s,transp:s,trigger:{defaultType:'duration',allowedTypes:['duration','date-time']},tzoffsetfrom:d,tzoffsetto:d,tzurl:c,tzid:s,tzname:s}),E=n.helpers.extend(Y,{text:r(e,i),uri:r(e,i),date:{decorate:function(h){return n.VCardTime.fromDateAndOrTimeString(h,'date');},undecorate:function(h){return h.toString();},fromICAL:function(h){return h.length==8?D.date.fromICAL(h):h[0]=='-'&&h.length==6?h.substr(0,4)+'-'+h.substr(4):h;},toICAL:function(h){return h.length==10?D.date.toICAL(h):h[0]=='-'&&h.length==7?h.substr(0,4)+h.substr(5):h;}},time:{decorate:function(h){return n.VCardTime.fromDateAndOrTimeString('T'+h,'time');},undecorate:function(h){return h.toString();},fromICAL:function(h){var g=E.time._splitZone(h,!0),w=g[0],O=g[1];return O.length==6?O=O.substr(0,2)+':'+O.substr(2,2)+':'+O.substr(4,2):O.length==4&&O[0]!='-'?O=O.substr(0,2)+':'+O.substr(2,2):O.length==5&&(O=O.substr(0,3)+':'+O.substr(3,2)),w.length==5&&(w[0]=='-'||w[0]=='+')&&(w=w.substr(0,3)+':'+w.substr(3)),O+w;},toICAL:function(h){var g=E.time._splitZone(h),w=g[0],O=g[1];return O.length==8?O=O.substr(0,2)+O.substr(3,2)+O.substr(6,2):O.length==5&&O[0]!='-'?O=O.substr(0,2)+O.substr(3,2):O.length==6&&(O=O.substr(0,3)+O.substr(4,2)),w.length==6&&(w[0]=='-'||w[0]=='+')&&(w=w.substr(0,3)+w.substr(4)),O+w;},_splitZone:function(h,g){var w=h.length-1,O=h.length-(g?5:6),B=h[O],U,H;return h[w]=='Z'?(U=h[w],H=h.substr(0,w)):h.length>6&&(B=='-'||B=='+')?(U=h.substr(O),H=h.substr(0,O)):(U='',H=h),[U,H];}},'date-time':{decorate:function(h){return n.VCardTime.fromDateAndOrTimeString(h,'date-time');},undecorate:function(h){return h.toString();},fromICAL:function(h){return E['date-and-or-time'].fromICAL(h);},toICAL:function(h){return E['date-and-or-time'].toICAL(h);}},'date-and-or-time':{decorate:function(h){return n.VCardTime.fromDateAndOrTimeString(h,'date-and-or-time');},undecorate:function(h){return h.toString();},fromICAL:function(h){var g=h.split('T');return(g[0]?E.date.fromICAL(g[0]):'')+(g[1]?'T'+E.time.fromICAL(g[1]):'');},toICAL:function(h){var g=h.split('T');return E.date.toICAL(g[0])+(g[1]?'T'+E.time.toICAL(g[1]):'');}},timestamp:D['date-time'],'language-tag':{matches:/^[a-zA-Z0-9-]+$/}}),C={type:{valueType:'text',multiValue:','},value:{values:['text','uri','date','time','date-time','date-and-or-time','timestamp','boolean','integer','float','utc-offset','language-tag'],allowXName:!0,allowIanaToken:!0}},P=n.helpers.extend(b,{adr:{defaultType:'text',structuredValue:';',multiValue:','},anniversary:v,bday:v,caladruri:c,caluri:c,clientpidmap:u,email:s,fburl:c,fn:s,gender:u,geo:c,impp:c,key:c,kind:s,lang:{defaultType:'language-tag'},logo:c,member:c,n:{defaultType:'text',structuredValue:';',multiValue:','},nickname:a,note:s,org:{defaultType:'text',structuredValue:';'},photo:c,related:c,rev:{defaultType:'timestamp'},role:s,sound:c,source:c,tel:{defaultType:'uri',allowedTypes:['uri','text']},title:s,tz:{defaultType:'text',allowedTypes:['text','utc-offset','uri']},xml:s}),x=n.helpers.extend(Y,{binary:D.binary,date:E.date,'date-time':E['date-time'],'phone-number':{},uri:D.uri,text:D.text,time:D.time,vcard:D.text,'utc-offset':{toICAL:function(h){return h.substr(0,7);},fromICAL:function(h){return h.substr(0,7);},decorate:function(h){return n.UtcOffset.fromString(h);},undecorate:function(h){return h.toString();}}}),z={type:{valueType:'text',multiValue:','},value:{values:['text','uri','date','date-time','phone-number','time','boolean','integer','float','utc-offset','vcard','binary'],allowXName:!0,allowIanaToken:!0}},L=n.helpers.extend(b,{fn:s,n:{defaultType:'text',structuredValue:';',multiValue:','},nickname:a,photo:{defaultType:'binary',allowedTypes:['binary','uri']},bday:{defaultType:'date-time',allowedTypes:['date-time','date'],detectType:function(h){return h.indexOf('T')===-1?'date':'date-time';}},adr:{defaultType:'text',structuredValue:';',multiValue:','},label:s,tel:{defaultType:'phone-number'},email:s,mailer:s,tz:{defaultType:'utc-offset',allowedTypes:['utc-offset','text']},geo:{defaultType:'float',structuredValue:';'},title:s,role:s,logo:{defaultType:'binary',allowedTypes:['binary','uri']},agent:{defaultType:'vcard',allowedTypes:['vcard','text','uri']},org:u,note:a,prodid:s,rev:{defaultType:'date-time',allowedTypes:['date-time','date'],detectType:function(h){return h.indexOf('T')===-1?'date':'date-time';}},'sort-string':s,sound:{defaultType:'binary',allowedTypes:['binary','uri']},class:s,key:{defaultType:'binary',allowedTypes:['binary','text']}}),I={value:D,param:A,property:N},S={value:E,param:C,property:P},W={value:x,param:z,property:L},M={strict:!0,defaultSet:I,defaultType:'unknown',components:{vcard:S,vcard3:W,vevent:I,vtodo:I,vjournal:I,valarm:I,vtimezone:I,daylight:I,standard:I},icalendar:I,vcard:S,vcard3:W,getDesignSet:function(h){var g=h&&h in M.components;return g?M.components[h]:M.defaultSet;}};return M;}(),n.stringify=function(){var o=`\r
`,t='unknown',e=n.design,i=n.helpers;function r(a){typeof a[0]=='string'&&(a=[a]);for(var u=0,f=a.length,l='';u<f;u++)l+=r.component(a[u])+o;return l;}r.component=function(a,u){var f=a[0].toUpperCase(),l='BEGIN:'+f+o,m=a[1],c=0,d=m.length,y=a[0];for(y==='vcard'&&a[1].length>0&&!(a[1][0][0]==='version'&&a[1][0][3]==='4.0')&&(y='vcard3'),u=u||e.getDesignSet(y);c<d;c++)l+=r.property(m[c],u)+o;for(var v=a[2]||[],p=0,T=v.length;p<T;p++)l+=r.component(v[p],u)+o;return l+='END:'+f,l;},r.property=function(a,u,f){var l=a[0].toUpperCase(),m=a[0],c=a[1],d=l,y;for(y in c){var v=c[y];if(c.hasOwnProperty(y)){var b=y in u.param&&u.param[y].multiValue;b&&Array.isArray(v)?(u.param[y].multiValueSeparateDQuote&&(b='"'+b+'"'),v=v.map(r._rfc6868Unescape),v=r.multiValue(v,b,'unknown',null,u)):v=r._rfc6868Unescape(v),d+=';'+y.toUpperCase(),d+='='+r.propertyValue(v);}}if(a.length===3)return d+':';var p=a[2];u||(u=e.defaultSet);var T,b=!1,Y=!1,A=!1;return m in u.property?(T=u.property[m],'multiValue'in T&&(b=T.multiValue),'structuredValue'in T&&Array.isArray(a[3])&&(Y=T.structuredValue),'defaultType'in T?p===T.defaultType&&(A=!0):p===t&&(A=!0)):p===t&&(A=!0),A||(d+=';VALUE='+p.toUpperCase()),d+=':',b&&Y?d+=r.multiValue(a[3],Y,p,b,u,Y):b?d+=r.multiValue(a.slice(3),b,p,null,u,!1):Y?d+=r.multiValue(a[3],Y,p,null,u,Y):d+=r.value(a[3],p,u,!1),f?d:n.helpers.foldline(d);},r.propertyValue=function(a){return i.unescapedIndexOf(a,',')===-1&&i.unescapedIndexOf(a,':')===-1&&i.unescapedIndexOf(a,';')===-1?a:'"'+a+'"';},r.multiValue=function(a,u,f,l,m,c){for(var d='',y=a.length,v=0;v<y;v++)l&&Array.isArray(a[v])?d+=r.multiValue(a[v],l,f,null,m,c):d+=r.value(a[v],f,m,c),v!==y-1&&(d+=u);return d;},r.value=function(a,u,f,l){return u in f.value&&'toICAL'in f.value[u]?f.value[u].toICAL(a,l):a;},r._rfc6868Unescape=function(a){return a.replace(/[\n^"]/g,(u) =>{return s[u];});};var s={'"':'^\'','\n':'^n','^':'^^'};return r;}(),n.parse=function(){var o=/[^ \t]/,t=':',e=';',i='=',r='unknown',s='text',a=n.design,u=n.helpers;function f(c){this.message=c,this.name='ParserError';try{throw new Error;}catch(y){if(y.stack){var d=y.stack.split(`
`);d.shift(),this.stack=d.join(`
`);}}}f.prototype=Error.prototype;function l(c){var d={},y=d.component=[];if(d.stack=[y],l._eachLine(c,(v,p) =>{l._handleContentLine(p,d);}),d.stack.length>1)throw new f('invalid ical body. component began but did not end');return d=null,y.length==1?y[0]:y;}l.property=function(c,d){var y={component:[[],[]],designSet:d||a.defaultSet};return l._handleContentLine(c,y),y.component[1][0];},l.component=function(c){return l(c);},l.ParserError=f,l._handleContentLine=function(c,d){var y=c.indexOf(t),v=c.indexOf(e),p,T,b,Y,A={};v!==-1&&y!==-1&&v>y&&(v=-1);var D;if(v!==-1){if(b=c.substring(0,v).toLowerCase(),D=l._parseParameters(c.substring(v),0,d.designSet),D[2]==-1)throw new f('Invalid parameters in \''+c+'\'');if(A=D[0],p=D[1].length+D[2]+v,(T=c.substring(p).indexOf(t))!==-1)Y=c.substring(p+T+1);else throw new f('Missing parameter value in \''+c+'\'');}else if(y!==-1){if(b=c.substring(0,y).toLowerCase(),Y=c.substring(y+1),b==='begin'){var N=[Y.toLowerCase(),[],[]];d.stack.length===1?d.component.push(N):d.component[2].push(N),d.stack.push(d.component),d.component=N,d.designSet||(d.designSet=a.getDesignSet(d.component[0]));return;}else if(b==='end'){d.component=d.stack.pop();return;}}else throw new f('invalid line (no token ";" or ":") "'+c+'"');var E,C=!1,P=!1,x;b in d.designSet.property&&(x=d.designSet.property[b],'multiValue'in x&&(C=x.multiValue),'structuredValue'in x&&(P=x.structuredValue),Y&&'detectType'in x&&(E=x.detectType(Y))),E||('value'in A?E=A.value.toLowerCase():x?E=x.defaultType:E=r),delete A.value;var z;C&&P?(Y=l._parseMultiValue(Y,P,E,[],C,d.designSet,P),z=[b,A,E,Y]):C?(z=[b,A,E],l._parseMultiValue(Y,C,E,z,null,d.designSet,!1)):P?(Y=l._parseMultiValue(Y,P,E,[],null,d.designSet,P),z=[b,A,E,Y]):(Y=l._parseValue(Y,E,d.designSet,!1),z=[b,A,E,Y]),d.component[0]==='vcard'&&d.component[1].length===0&&!(b==='version'&&Y==='4.0')&&(d.designSet=a.getDesignSet('vcard3')),d.component[1].push(z);},l._parseValue=function(c,d,y,v){return d in y.value&&'fromICAL'in y.value[d]?y.value[d].fromICAL(c,v):c;},l._parseParameters=function(c,d,y){for(var v=d,p=0,T=i,b={},Y,A,D,N=-1,E,C,P;p!==!1&&(p=u.unescapedIndexOf(c,T,p+1))!==-1;){if(Y=c.substr(v+1,p-v-1),Y.length==0)throw new f('Empty parameter name in \''+c+'\'');A=Y.toLowerCase(),P=!1,C=!1,A in y.param&&y.param[A].valueType?E=y.param[A].valueType:E=s,A in y.param&&(C=y.param[A].multiValue,y.param[A].multiValueSeparateDQuote&&(P=l._rfc6868Escape('"'+C+'"')));var x=c[p+1];if(x==='"'){if(N=p+2,p=u.unescapedIndexOf(c,'"',N),C&&p!=-1)for(var z=!0;z;)c[p+1]==C&&c[p+2]=='"'?p=u.unescapedIndexOf(c,'"',p+3):z=!1;if(p===-1)throw new f('invalid line (no matching double quote) "'+c+'"');D=c.substr(N,p-N),v=u.unescapedIndexOf(c,e,p),v===-1&&(p=!1);}else{N=p+1;var L=u.unescapedIndexOf(c,e,N),I=u.unescapedIndexOf(c,t,N);I!==-1&&L>I?(L=I,p=!1):L===-1?(I===-1?L=c.length:L=I,p=!1):(v=L,p=L),D=c.substr(N,L-N);}if(D=l._rfc6868Escape(D),C){var S=P||C;D=l._parseMultiValue(D,S,E,[],null,y);}else D=l._parseValue(D,E,y);C&&A in b?Array.isArray(b[A])?b[A].push(D):b[A]=[b[A],D]:b[A]=D;}return[b,D,N];},l._rfc6868Escape=function(c){return c.replace(/\^['n^]/g,(d) =>{return m[d];});};var m={'^\'':'"','^n':`
`,'^^':'^'};return l._parseMultiValue=function(c,d,y,v,p,T,b){var Y=0,A=0,D;if(d.length===0)return c;for(;(Y=u.unescapedIndexOf(c,d,A))!==-1;)D=c.substr(A,Y-A),p?D=l._parseMultiValue(D,p,y,[],null,T,b):D=l._parseValue(D,y,T,b),v.push(D),A=Y+d.length;return D=c.substr(A),p?D=l._parseMultiValue(D,p,y,[],null,T,b):D=l._parseValue(D,y,T,b),v.push(D),v.length==1?v[0]:v;},l._eachLine=function(c,d){var y=c.length,v=c.search(o),p=v,T,b,Y;do p=c.indexOf(`
`,v)+1,p>1&&c[p-2]==='\r'?Y=2:Y=1,p===0&&(p=y,Y=0),b=c[v],b===' '||b==='	'?T+=c.substr(v+1,p-v-(Y+1)):(T&&d(null,T),T=c.substr(v,p-v-Y)),v=p;while(p!==y);T=T.trim(),T.length&&d(null,T);},l;}(),n.Component=function(){var o=1,t=2,e=0;function i(r,s){typeof r=='string'&&(r=[r,[],[]]),this.jCal=r,this.parent=s||null;}return i.prototype={_hydratedPropertyCount:0,_hydratedComponentCount:0,get name(){return this.jCal[e];},get _designSet(){var r=this.parent&&this.parent._designSet;return r||n.design.getDesignSet(this.name);},_hydrateComponent:function(r){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[r])return this._components[r];var s=new i(this.jCal[t][r],this);return this._hydratedComponentCount++,this._components[r]=s;},_hydrateProperty:function(r){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[r])return this._properties[r];var s=new n.Property(this.jCal[o][r],this);return this._hydratedPropertyCount++,this._properties[r]=s;},getFirstSubcomponent:function(r){if(r){for(var s=0,a=this.jCal[t],u=a.length;s<u;s++)if(a[s][e]===r){var f=this._hydrateComponent(s);return f;}}else if(this.jCal[t].length)return this._hydrateComponent(0);return null;},getAllSubcomponents:function(r){var s=this.jCal[t].length,a=0;if(r){for(var u=this.jCal[t],f=[];a<s;a++)r===u[a][e]&&f.push(this._hydrateComponent(a));return f;}else{if(!this._components||this._hydratedComponentCount!==s)for(;a<s;a++)this._hydrateComponent(a);return this._components||[];}},hasProperty:function(r){for(var s=this.jCal[o],a=s.length,u=0;u<a;u++)if(s[u][e]===r)return!0;return!1;},getFirstProperty:function(r){if(r){for(var s=0,a=this.jCal[o],u=a.length;s<u;s++)if(a[s][e]===r){var f=this._hydrateProperty(s);return f;}}else if(this.jCal[o].length)return this._hydrateProperty(0);return null;},getFirstPropertyValue:function(r){var s=this.getFirstProperty(r);return s?s.getFirstValue():null;},getAllProperties:function(r){var s=this.jCal[o].length,a=0;if(r){for(var u=this.jCal[o],f=[];a<s;a++)r===u[a][e]&&f.push(this._hydrateProperty(a));return f;}else{if(!this._properties||this._hydratedPropertyCount!==s)for(;a<s;a++)this._hydrateProperty(a);return this._properties||[];}},_removeObjectByIndex:function(r,s,a){if(s=s||[],s[a]){var u=s[a];'parent'in u&&(u.parent=null);}s.splice(a,1),this.jCal[r].splice(a,1);},_removeObject:function(r,s,a){var u=0,f=this.jCal[r],l=f.length,m=this[s];if(typeof a=='string'){for(;u<l;u++)if(f[u][e]===a)return this._removeObjectByIndex(r,m,u),!0;}else if(m){for(;u<l;u++)if(m[u]&&m[u]===a)return this._removeObjectByIndex(r,m,u),!0;}return!1;},_removeAllObjects:function(r,s,a){for(var u=this[s],f=this.jCal[r],l=f.length-1;l>=0;l--)(!a||f[l][e]===a)&&this._removeObjectByIndex(r,u,l);},addSubcomponent:function(r){this._components||(this._components=[],this._hydratedComponentCount=0),r.parent&&r.parent.removeSubcomponent(r);var s=this.jCal[t].push(r.jCal);return this._components[s-1]=r,this._hydratedComponentCount++,r.parent=this,r;},removeSubcomponent:function(r){var s=this._removeObject(t,'_components',r);return s&&this._hydratedComponentCount--,s;},removeAllSubcomponents:function(r){var s=this._removeAllObjects(t,'_components',r);return this._hydratedComponentCount=0,s;},addProperty:function(r){if(!(r instanceof n.Property))throw new TypeError('must instance of ICAL.Property');this._properties||(this._properties=[],this._hydratedPropertyCount=0),r.parent&&r.parent.removeProperty(r);var s=this.jCal[o].push(r.jCal);return this._properties[s-1]=r,this._hydratedPropertyCount++,r.parent=this,r;},addPropertyWithValue:function(r,s){var a=new n.Property(r);return a.setValue(s),this.addProperty(a),a;},updatePropertyWithValue:function(r,s){var a=this.getFirstProperty(r);return a?a.setValue(s):a=this.addPropertyWithValue(r,s),a;},removeProperty:function(r){var s=this._removeObject(o,'_properties',r);return s&&this._hydratedPropertyCount--,s;},removeAllProperties:function(r){var s=this._removeAllObjects(o,'_properties',r);return this._hydratedPropertyCount=0,s;},toJSON:function(){return this.jCal;},toString:function(){return n.stringify.component(this.jCal,this._designSet);}},i.fromString=function(r){return new i(n.parse.component(r));},i;}(),n.Property=function(){var o=0,t=1,e=2,i=3,r=n.design;function s(a,u){this._parent=u||null,typeof a=='string'?(this.jCal=[a,{},r.defaultType],this.jCal[e]=this.getDefaultType()):this.jCal=a,this._updateType();}return s.prototype={get type(){return this.jCal[e];},get name(){return this.jCal[o];},get parent(){return this._parent;},set parent(a){var u=!this._parent||a&&a._designSet!=this._parent._designSet;return this._parent=a,this.type==r.defaultType&&u&&(this.jCal[e]=this.getDefaultType(),this._updateType()),a;},get _designSet(){return this.parent?this.parent._designSet:r.defaultSet;},_updateType:function(){var a=this._designSet;this.type in a.value&&(a.value[this.type],'decorate'in a.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in a.property&&(this.isMultiValue='multiValue'in a.property[this.name],this.isStructuredValue='structuredValue'in a.property[this.name]));},_hydrateValue:function(a){return this._values&&this._values[a]?this._values[a]:this.jCal.length<=i+a?null:this.isDecorated?(this._values||(this._values=[]),this._values[a]=this._decorate(this.jCal[i+a])):this.jCal[i+a];},_decorate:function(a){return this._designSet.value[this.type].decorate(a,this);},_undecorate:function(a){return this._designSet.value[this.type].undecorate(a,this);},_setDecoratedValue:function(a,u){this._values||(this._values=[]),typeof a=='object'&&'icaltype'in a?(this.jCal[i+u]=this._undecorate(a),this._values[u]=a):(this.jCal[i+u]=a,this._values[u]=this._decorate(a));},getParameter:function(a){if(a in this.jCal[t])return this.jCal[t][a];},getFirstParameter:function(a){var u=this.getParameter(a);return Array.isArray(u)?u[0]:u;},setParameter:function(a,u){var f=a.toLowerCase();typeof u=='string'&&f in this._designSet.param&&'multiValue'in this._designSet.param[f]&&(u=[u]),this.jCal[t][a]=u;},removeParameter:function(a){delete this.jCal[t][a];},getDefaultType:function(){var a=this.jCal[o],u=this._designSet;if(a in u.property){var f=u.property[a];if('defaultType'in f)return f.defaultType;}return r.defaultType;},resetType:function(a){this.removeAllValues(),this.jCal[e]=a,this._updateType();},getFirstValue:function(){return this._hydrateValue(0);},getValues:function(){var a=this.jCal.length-i;if(a<1)return[];for(var u=0,f=[];u<a;u++)f[u]=this._hydrateValue(u);return f;},removeAllValues:function(){this._values&&(this._values.length=0),this.jCal.length=3;},setValues:function(a){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);var u=a.length,f=0;if(this.removeAllValues(),u>0&&typeof a[0]=='object'&&'icaltype'in a[0]&&this.resetType(a[0].icaltype),this.isDecorated)for(;f<u;f++)this._setDecoratedValue(a[f],f);else for(;f<u;f++)this.jCal[i+f]=a[f];},setValue:function(a){this.removeAllValues(),typeof a=='object'&&'icaltype'in a&&this.resetType(a.icaltype),this.isDecorated?this._setDecoratedValue(a,0):this.jCal[i]=a;},toJSON:function(){return this.jCal;},toICALString:function(){return n.stringify.property(this.jCal,this._designSet,!0);}},s.fromString=function(a,u){return new s(n.parse.property(a,u));},s;}(),n.UtcOffset=function(){function o(t){this.fromData(t);}return o.prototype={hours:0,minutes:0,factor:1,icaltype:'utc-offset',clone:function(){return n.UtcOffset.fromSeconds(this.toSeconds());},fromData:function(t){if(t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this._normalize();},fromSeconds:function(t){var e=Math.abs(t);return this.factor=t<0?-1:1,this.hours=n.helpers.trunc(e/3600),e-=this.hours*3600,this.minutes=n.helpers.trunc(e/60),this;},toSeconds:function(){return this.factor*(60*this.minutes+3600*this.hours);},compare:function(e){var i=this.toSeconds(),r=e.toSeconds();return(i>r)-(r>i);},_normalize:function(){for(var t=this.toSeconds(),e=this.factor;t<-43200;)t+=97200;for(;t>50400;)t-=97200;this.fromSeconds(t),t==0&&(this.factor=e);},toICALString:function(){return n.design.icalendar.value['utc-offset'].toICAL(this.toString());},toString:function(){return(this.factor==1?'+':'-')+n.helpers.pad2(this.hours)+':'+n.helpers.pad2(this.minutes);}},o.fromString=function(t){var e={};return e.factor=t[0]==='+'?1:-1,e.hours=n.helpers.strictParseInt(t.substr(1,2)),e.minutes=n.helpers.strictParseInt(t.substr(4,2)),new n.UtcOffset(e);},o.fromSeconds=function(t){var e=new o;return e.fromSeconds(t),e;},o;}(),n.Binary=function(){function o(t){this.value=t;}return o.prototype={icaltype:'binary',decodeValue:function(){return this._b64_decode(this.value);},setEncodedValue:function(e){this.value=this._b64_encode(e);},_b64_encode:function(e){var i='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',r,s,a,u,f,l,m,c,d=0,y=0,v='',p=[];if(!e)return e;do r=e.charCodeAt(d++),s=e.charCodeAt(d++),a=e.charCodeAt(d++),c=r<<16|s<<8|a,u=c>>18&63,f=c>>12&63,l=c>>6&63,m=c&63,p[y++]=i.charAt(u)+i.charAt(f)+i.charAt(l)+i.charAt(m);while(d<e.length);v=p.join('');var T=e.length%3;return(T?v.slice(0,T-3):v)+'==='.slice(T||3);},_b64_decode:function(e){var i='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',r,s,a,u,f,l,m,c,d=0,y=0,v='',p=[];if(!e)return e;e+='';do u=i.indexOf(e.charAt(d++)),f=i.indexOf(e.charAt(d++)),l=i.indexOf(e.charAt(d++)),m=i.indexOf(e.charAt(d++)),c=u<<18|f<<12|l<<6|m,r=c>>16&255,s=c>>8&255,a=c&255,l==64?p[y++]=String.fromCharCode(r):m==64?p[y++]=String.fromCharCode(r,s):p[y++]=String.fromCharCode(r,s,a);while(d<e.length);return v=p.join(''),v;},toString:function(){return this.value;}},o.fromString=function(t){return new o(t);},o;}(),function(){n.Period=function(t){if(this.wrappedJSObject=this,t&&'start'in t){if(t.start&&!(t.start instanceof n.Time))throw new TypeError('.start must be an instance of ICAL.Time');this.start=t.start;}if(t&&t.end&&t.duration)throw new Error('cannot accept both end and duration');if(t&&'end'in t){if(t.end&&!(t.end instanceof n.Time))throw new TypeError('.end must be an instance of ICAL.Time');this.end=t.end;}if(t&&'duration'in t){if(t.duration&&!(t.duration instanceof n.Duration))throw new TypeError('.duration must be an instance of ICAL.Duration');this.duration=t.duration;}},n.Period.prototype={start:null,end:null,duration:null,icalclass:'icalperiod',icaltype:'period',clone:function(){return n.Period.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null});},getDuration:function(){return this.duration?this.duration:this.end.subtractDate(this.start);},getEnd:function(){if(this.end)return this.end;var o=this.start.clone();return o.addDuration(this.duration),o;},toString:function(){return this.start+'/'+(this.end||this.duration);},toJSON:function(){return[this.start.toString(),(this.end||this.duration).toString()];},toICALString:function(){return this.start.toICALString()+'/'+(this.end||this.duration).toICALString();}},n.Period.fromString=function(t,e){var i=t.split('/');if(i.length!==2)throw new Error('Invalid string value: "'+t+'" must contain a "/" char.');var r={start:n.Time.fromDateTimeString(i[0],e)},s=i[1];return n.Duration.isValueString(s)?r.duration=n.Duration.fromString(s):r.end=n.Time.fromDateTimeString(s,e),new n.Period(r);},n.Period.fromData=function(t){return new n.Period(t);},n.Period.fromJSON=function(o,t,e){function i(r,s){return e?n.Time.fromString(r,s):n.Time.fromDateTimeString(r,s);}return n.Duration.isValueString(o[1])?n.Period.fromData({start:i(o[0],t),duration:n.Duration.fromString(o[1])}):n.Period.fromData({start:i(o[0],t),end:i(o[1],t)});};}(),function(){var o=/([PDWHMTS]{1,1})/;n.Duration=function(i){this.wrappedJSObject=this,this.fromData(i);},n.Duration.prototype={weeks:0,days:0,hours:0,minutes:0,seconds:0,isNegative:!1,icalclass:'icalduration',icaltype:'duration',clone:function(){return n.Duration.fromData(this);},toSeconds:function(){var i=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-i:i;},fromSeconds:function(i){var r=Math.abs(i);return this.isNegative=i<0,this.days=n.helpers.trunc(r/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,r-=(this.days+7*this.weeks)*86400,this.hours=n.helpers.trunc(r/3600),r-=this.hours*3600,this.minutes=n.helpers.trunc(r/60),r-=this.minutes*60,this.seconds=r,this;},fromData:function(i){var r=['weeks','days','hours','minutes','seconds','isNegative'];for(var s in r)if(r.hasOwnProperty(s)){var a=r[s];i&&a in i?this[a]=i[a]:this[a]=0;}},reset:function(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0;},compare:function(i){var r=this.toSeconds(),s=i.toSeconds();return(r>s)-(r<s);},normalize:function(){this.fromSeconds(this.toSeconds());},toString:function(){if(this.toSeconds()==0)return'PT0S';var i='';return this.isNegative&&(i+='-'),i+='P',this.weeks&&(i+=this.weeks+'W'),this.days&&(i+=this.days+'D'),(this.hours||this.minutes||this.seconds)&&(i+='T',this.hours&&(i+=this.hours+'H'),this.minutes&&(i+=this.minutes+'M'),this.seconds&&(i+=this.seconds+'S')),i;},toICALString:function(){return this.toString();}},n.Duration.fromSeconds=function(i){return new n.Duration().fromSeconds(i);};function t(e,i,r){var s;switch(e){case'P':i&&i==='-'?r.isNegative=!0:r.isNegative=!1;break;case'D':s='days';break;case'W':s='weeks';break;case'H':s='hours';break;case'M':s='minutes';break;case'S':s='seconds';break;default:return 0;}if(s){if(!i&&i!==0)throw new Error('invalid duration value: Missing number before "'+e+'"');var a=parseInt(i,10);if(n.helpers.isStrictlyNaN(a))throw new Error('invalid duration value: Invalid number "'+i+'" before "'+e+'"');r[s]=a;}return 1;}n.Duration.isValueString=function(e){return e[0]==='P'||e[1]==='P';},n.Duration.fromString=function(i){for(var r=0,s=Object.create(null),a=0;(r=i.search(o))!==-1;){var u=i[r],f=i.substr(0,r);i=i.substr(r+1),a+=t(u,f,s);}if(a<2)throw new Error('invalid duration value: Not enough duration components in "'+i+'"');return new n.Duration(s);},n.Duration.fromData=function(i){return new n.Duration(i);};}(),function(){var o=['tzid','location','tznames','latitude','longitude'];n.Timezone=function(e){this.wrappedJSObject=this,this.fromData(e);},n.Timezone.prototype={tzid:'',location:'',tznames:'',latitude:0,longitude:0,component:null,expandedUntilYear:0,icalclass:'icaltimezone',fromData:function(e){if(this.expandedUntilYear=0,this.changes=[],e instanceof n.Component)this.component=e;else{if(e&&'component'in e)if(typeof e.component=='string'){var i=n.parse(e.component);this.component=new n.Component(i);}else e.component instanceof n.Component?this.component=e.component:this.component=null;for(var r in o)if(o.hasOwnProperty(r)){var s=o[r];e&&s in e&&(this[s]=e[s]);}}return this.component instanceof n.Component&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue('tzid')),this;},utcOffset:function(e){if(this==n.Timezone.utcTimezone||this==n.Timezone.localTimezone||(this._ensureCoverage(e.year),!this.changes.length))return 0;for(var i={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second},r=this._findNearbyChange(i),s=-1,a=1;;){var u=n.helpers.clone(this.changes[r],!0);u.utcOffset<u.prevUtcOffset?n.Timezone.adjust_change(u,0,0,0,u.utcOffset):n.Timezone.adjust_change(u,0,0,0,u.prevUtcOffset);var f=n.Timezone._compare_change_fn(i,u);if(f>=0?s=r:a=-1,a==-1&&s!=-1)break;if(r+=a,r<0)return 0;if(r>=this.changes.length)break;}var l=this.changes[s],m=l.utcOffset-l.prevUtcOffset;if(m<0&&s>0){var c=n.helpers.clone(l,!0);if(n.Timezone.adjust_change(c,0,0,0,c.prevUtcOffset),n.Timezone._compare_change_fn(i,c)<0){var d=this.changes[s-1],y=!1;l.is_daylight!=y&&d.is_daylight==y&&(l=d);}}return l.utcOffset;},_findNearbyChange:function(e){var i=n.helpers.binsearchInsert(this.changes,e,n.Timezone._compare_change_fn);return i>=this.changes.length?this.changes.length-1:i;},_ensureCoverage:function(t){if(n.Timezone._minimumExpansionYear==-1){var e=n.Time.now();n.Timezone._minimumExpansionYear=e.year;}var i=t;if(i<n.Timezone._minimumExpansionYear&&(i=n.Timezone._minimumExpansionYear),i+=n.Timezone.EXTRA_COVERAGE,i>n.Timezone.MAX_YEAR&&(i=n.Timezone.MAX_YEAR),!this.changes.length||this.expandedUntilYear<t){for(var r=this.component.getAllSubcomponents(),s=r.length,a=0;a<s;a++)this._expandComponent(r[a],i,this.changes);this.changes.sort(n.Timezone._compare_change_fn),this.expandedUntilYear=i;}},_expandComponent:function(t,e,i){if(!t.hasProperty('dtstart')||!t.hasProperty('tzoffsetto')||!t.hasProperty('tzoffsetfrom'))return null;var r=t.getFirstProperty('dtstart').getFirstValue(),s;function a(p){return p.factor*(p.hours*3600+p.minutes*60);}function u(){var p={};return p.is_daylight=t.name=='daylight',p.utcOffset=a(t.getFirstProperty('tzoffsetto').getFirstValue()),p.prevUtcOffset=a(t.getFirstProperty('tzoffsetfrom').getFirstValue()),p;}if(!t.hasProperty('rrule')&&!t.hasProperty('rdate'))s=u(),s.year=r.year,s.month=r.month,s.day=r.day,s.hour=r.hour,s.minute=r.minute,s.second=r.second,n.Timezone.adjust_change(s,0,0,0,-s.prevUtcOffset),i.push(s);else{var f=t.getAllProperties('rdate');for(var l in f)if(f.hasOwnProperty(l)){var m=f[l],c=m.getFirstValue();s=u(),s.year=c.year,s.month=c.month,s.day=c.day,c.isDate?(s.hour=r.hour,s.minute=r.minute,s.second=r.second,r.zone!=n.Timezone.utcTimezone&&n.Timezone.adjust_change(s,0,0,0,-s.prevUtcOffset)):(s.hour=c.hour,s.minute=c.minute,s.second=c.second,c.zone!=n.Timezone.utcTimezone&&n.Timezone.adjust_change(s,0,0,0,-s.prevUtcOffset)),i.push(s);}var d=t.getFirstProperty('rrule');if(d){d=d.getFirstValue(),s=u(),d.until&&d.until.zone==n.Timezone.utcTimezone&&(d.until.adjust(0,0,0,s.prevUtcOffset),d.until.zone=n.Timezone.localTimezone);for(var y=d.iterator(r),v;(v=y.next())&&(s=u(),!(v.year>e||!v));)s.year=v.year,s.month=v.month,s.day=v.day,s.hour=v.hour,s.minute=v.minute,s.second=v.second,s.isDate=v.isDate,n.Timezone.adjust_change(s,0,0,0,-s.prevUtcOffset),i.push(s);}}return i;},toString:function(){return this.tznames?this.tznames:this.tzid;}},n.Timezone._compare_change_fn=function(e,i){return e.year<i.year?-1:e.year>i.year?1:e.month<i.month?-1:e.month>i.month?1:e.day<i.day?-1:e.day>i.day?1:e.hour<i.hour?-1:e.hour>i.hour?1:e.minute<i.minute?-1:e.minute>i.minute?1:e.second<i.second?-1:e.second>i.second?1:0;},n.Timezone.convert_time=function(e,i,r){if(e.isDate||i.tzid==r.tzid||i==n.Timezone.localTimezone||r==n.Timezone.localTimezone)return e.zone=r,e;var s=i.utcOffset(e);return e.adjust(0,0,0,-s),s=r.utcOffset(e),e.adjust(0,0,0,s),null;},n.Timezone.fromData=function(e){var i=new n.Timezone;return i.fromData(e);},n.Timezone.utcTimezone=n.Timezone.fromData({tzid:'UTC'}),n.Timezone.localTimezone=n.Timezone.fromData({tzid:'floating'}),n.Timezone.adjust_change=function(e,i,r,s,a){return n.Time.prototype.adjust.call(e,i,r,s,a,e);},n.Timezone._minimumExpansionYear=-1,n.Timezone.MAX_YEAR=2035,n.Timezone.EXTRA_COVERAGE=5;}(),n.TimezoneService=function(){var o,t={get count(){return Object.keys(o).length;},reset:function(){o=Object.create(null);var e=n.Timezone.utcTimezone;o.Z=e,o.UTC=e,o.GMT=e;},has:function(e){return!!o[e];},get:function(e){return o[e];},register:function(e,i){if(e instanceof n.Component&&e.name==='vtimezone'&&(i=new n.Timezone(e),e=i.tzid),i instanceof n.Timezone)o[e]=i;else throw new TypeError('timezone must be ICAL.Timezone or ICAL.Component');},remove:function(e){return delete o[e];}};return t.reset(),t;}(),function(){n.Time=function(t,e){this.wrappedJSObject=this;var i=this._time=Object.create(null);i.year=0,i.month=1,i.day=1,i.hour=0,i.minute=0,i.second=0,i.isDate=!1,this.fromData(t,e);},n.Time._dowCache={},n.Time._wnCache={},n.Time.prototype={icalclass:'icaltime',_cachedUnixTime:null,get icaltype(){return this.isDate?'date':'date-time';},zone:null,_pendingNormalization:!1,clone:function(){return new n.Time(this._time,this.zone);},reset:function(){this.fromData(n.Time.epochTime),this.zone=n.Timezone.utcTimezone;},resetTo:function(t,e,i,r,s,a,u){this.fromData({year:t,month:e,day:i,hour:r,minute:s,second:a,zone:u});},fromJSDate:function(t,e){return t?e?(this.zone=n.Timezone.utcTimezone,this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()):(this.zone=n.Timezone.localTimezone,this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate(),this.hour=t.getHours(),this.minute=t.getMinutes(),this.second=t.getSeconds()):this.reset(),this._cachedUnixTime=null,this;},fromData:function(t,e){if(t){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){if(i==='icaltype')continue;this[i]=t[i];}}if(e&&(this.zone=e),t&&!('isDate'in t)?this.isDate=!('hour'in t):t&&'isDate'in t&&(this.isDate=t.isDate),t&&'timezone'in t){var r=n.TimezoneService.get(t.timezone);this.zone=r||n.Timezone.localTimezone;}return t&&'zone'in t&&(this.zone=t.zone),this.zone||(this.zone=n.Timezone.localTimezone),this._cachedUnixTime=null,this;},dayOfWeek:function(t){var e=t||n.Time.SUNDAY,i=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(i in n.Time._dowCache)return n.Time._dowCache[i];var r=this.day,s=this.month+(this.month<3?12:0),a=this.year-(this.month<3?1:0),u=r+a+n.helpers.trunc((s+1)*26/10)+n.helpers.trunc(a/4);return u+=n.helpers.trunc(a/100)*6+n.helpers.trunc(a/400),u=(u+7-e)%7+1,n.Time._dowCache[i]=u,u;},dayOfYear:function(){var t=n.Time.isLeapYear(this.year)?1:0,e=n.Time.daysInYearPassedMonth;return e[t][this.month-1]+this.day;},startOfWeek:function(t){var e=t||n.Time.SUNDAY,i=this.clone();return i.day-=(this.dayOfWeek()+7-e)%7,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i;},endOfWeek:function(t){var e=t||n.Time.SUNDAY,i=this.clone();return i.day+=(7-this.dayOfWeek()+e-n.Time.SUNDAY)%7,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i;},startOfMonth:function(){var t=this.clone();return t.day=1,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t;},endOfMonth:function(){var t=this.clone();return t.day=n.Time.daysInMonth(t.month,t.year),t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t;},startOfYear:function(){var t=this.clone();return t.day=1,t.month=1,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t;},endOfYear:function(){var t=this.clone();return t.day=31,t.month=12,t.isDate=!0,t.hour=0,t.minute=0,t.second=0,t;},startDoyWeek:function(t){var e=t||n.Time.SUNDAY,i=this.dayOfWeek()-e;return i<0&&(i+=7),this.dayOfYear()-i;},getDominicalLetter:function(){return n.Time.getDominicalLetter(this.year);},nthWeekDay:function(t,e){var i=n.Time.daysInMonth(this.month,this.year),r,s=e,a=0,u=this.clone();if(s>=0){u.day=1,s!=0&&s--,a=u.day;var f=u.dayOfWeek(),l=t-f;l<0&&(l+=7),a+=l,a-=t,r=t;}else{u.day=i;var m=u.dayOfWeek();s++,r=m-t,r<0&&(r+=7),r=i-r;}return r+=s*7,a+r;},isNthWeekDay:function(o,t){var e=this.dayOfWeek();if(t===0&&e===o)return!0;var i=this.nthWeekDay(o,t);return i===this.day;},weekNumber:function(t){var e=(this.year<<12)+(this.month<<8)+(this.day<<3)+t;if(e in n.Time._wnCache)return n.Time._wnCache[e];var i,r=this.clone();r.isDate=!0;var s=this.year;r.month==12&&r.day>25?(i=n.Time.weekOneStarts(s+1,t),r.compare(i)<0?i=n.Time.weekOneStarts(s,t):s++):(i=n.Time.weekOneStarts(s,t),r.compare(i)<0&&(i=n.Time.weekOneStarts(--s,t)));var a=r.subtractDate(i).toSeconds()/86400,u=n.helpers.trunc(a/7)+1;return n.Time._wnCache[e]=u,u;},addDuration:function(t){var e=t.isNegative?-1:1,i=this.second,r=this.minute,s=this.hour,a=this.day;i+=e*t.seconds,r+=e*t.minutes,s+=e*t.hours,a+=e*t.days,a+=e*7*t.weeks,this.second=i,this.minute=r,this.hour=s,this.day=a,this._cachedUnixTime=null;},subtractDate:function(t){var e=this.toUnixTime()+this.utcOffset(),i=t.toUnixTime()+t.utcOffset();return n.Duration.fromSeconds(e-i);},subtractDateTz:function(t){var e=this.toUnixTime(),i=t.toUnixTime();return n.Duration.fromSeconds(e-i);},compare:function(t){var e=this.toUnixTime(),i=t.toUnixTime();return e>i?1:i>e?-1:0;},compareDateOnlyTz:function(t,e){function i(u){return n.Time._cmp_attr(r,s,u);}var r=this.convertToZone(e),s=t.convertToZone(e),a=0;return(a=i('year'))!=0||(a=i('month'))!=0||(a=i('day'))!=0,a;},convertToZone:function(t){var e=this.clone(),i=this.zone.tzid==t.tzid;return!this.isDate&&!i&&n.Timezone.convert_time(e,this.zone,t),e.zone=t,e;},utcOffset:function(){return this.zone==n.Timezone.localTimezone||this.zone==n.Timezone.utcTimezone?0:this.zone.utcOffset(this);},toICALString:function(){var o=this.toString();return o.length>10?n.design.icalendar.value['date-time'].toICAL(o):n.design.icalendar.value.date.toICAL(o);},toString:function(){var t=this.year+'-'+n.helpers.pad2(this.month)+'-'+n.helpers.pad2(this.day);return this.isDate||(t+='T'+n.helpers.pad2(this.hour)+':'+n.helpers.pad2(this.minute)+':'+n.helpers.pad2(this.second),this.zone===n.Timezone.utcTimezone&&(t+='Z')),t;},toJSDate:function(){return this.zone==n.Timezone.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3);},_normalize:function(){return this._time.isDate,this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this;},adjust:function(t,e,i,r,s){var a,u,f=0,l=0,m,c,d,y,v,p=s||this._time;if(p.isDate||(m=p.second+r,p.second=m%60,a=n.helpers.trunc(m/60),p.second<0&&(p.second+=60,a--),c=p.minute+i+a,p.minute=c%60,u=n.helpers.trunc(c/60),p.minute<0&&(p.minute+=60,u--),d=p.hour+e+u,p.hour=d%24,f=n.helpers.trunc(d/24),p.hour<0&&(p.hour+=24,f--)),p.month>12?l=n.helpers.trunc((p.month-1)/12):p.month<1&&(l=n.helpers.trunc(p.month/12)-1),p.year+=l,p.month-=12*l,y=p.day+t+f,y>0)for(;v=n.Time.daysInMonth(p.month,p.year),!(y<=v);)p.month++,p.month>12&&(p.year++,p.month=1),y-=v;else for(;y<=0;)p.month==1?(p.year--,p.month=12):p.month--,y+=n.Time.daysInMonth(p.month,p.year);return p.day=y,this._cachedUnixTime=null,this;},fromUnixTime:function(t){this.zone=n.Timezone.utcTimezone;var e=n.Time.epochTime.clone();e.adjust(0,0,0,t),this.year=e.year,this.month=e.month,this.day=e.day,this.hour=e.hour,this.minute=e.minute,this.second=Math.floor(e.second),this._cachedUnixTime=null;},toUnixTime:function(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;var t=this.utcOffset(),e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-t);return this._cachedUnixTime=e/1e3,this._cachedUnixTime;},toJSON:function(){for(var o=['year','month','day','hour','minute','second','isDate'],t=Object.create(null),e=0,i=o.length,r;e<i;e++)r=o[e],t[r]=this[r];return this.zone&&(t.timezone=this.zone.tzid),t;}},function(){function t(e){Object.defineProperty(n.Time.prototype,e,{get:function(){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[e];},set:function(r){return e==='isDate'&&r&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[e]=r,r;}});}'defineProperty'in Object&&(t('year'),t('month'),t('day'),t('hour'),t('minute'),t('second'),t('isDate'));}(),n.Time.daysInMonth=function(t,e){var i=[0,31,28,31,30,31,30,31,31,30,31,30,31],r=30;return t<1||t>12||(r=i[t],t==2&&(r+=n.Time.isLeapYear(e))),r;},n.Time.isLeapYear=function(t){return t<=1752?t%4==0:t%4==0&&t%100!=0||t%400==0;},n.Time.fromDayOfYear=function(t,e){var i=e,r=t,s=new n.Time;s.auto_normalize=!1;var a=n.Time.isLeapYear(i)?1:0;if(r<1)return i--,a=n.Time.isLeapYear(i)?1:0,r+=n.Time.daysInYearPassedMonth[a][12],n.Time.fromDayOfYear(r,i);if(r>n.Time.daysInYearPassedMonth[a][12])return a=n.Time.isLeapYear(i)?1:0,r-=n.Time.daysInYearPassedMonth[a][12],i++,n.Time.fromDayOfYear(r,i);s.year=i,s.isDate=!0;for(var u=11;u>=0;u--)if(r>n.Time.daysInYearPassedMonth[a][u]){s.month=u+1,s.day=r-n.Time.daysInYearPassedMonth[a][u];break;}return s.auto_normalize=!0,s;},n.Time.fromStringv2=function(t){return new n.Time({year:parseInt(t.substr(0,4),10),month:parseInt(t.substr(5,2),10),day:parseInt(t.substr(8,2),10),isDate:!0});},n.Time.fromDateString=function(o){return new n.Time({year:n.helpers.strictParseInt(o.substr(0,4)),month:n.helpers.strictParseInt(o.substr(5,2)),day:n.helpers.strictParseInt(o.substr(8,2)),isDate:!0});},n.Time.fromDateTimeString=function(o,t){if(o.length<19)throw new Error('invalid date-time value: "'+o+'"');var e;o[19]&&o[19]==='Z'?e='Z':t&&(e=t.getParameter('tzid'));var i=new n.Time({year:n.helpers.strictParseInt(o.substr(0,4)),month:n.helpers.strictParseInt(o.substr(5,2)),day:n.helpers.strictParseInt(o.substr(8,2)),hour:n.helpers.strictParseInt(o.substr(11,2)),minute:n.helpers.strictParseInt(o.substr(14,2)),second:n.helpers.strictParseInt(o.substr(17,2)),timezone:e});return i;},n.Time.fromString=function(t,e){return t.length>10?n.Time.fromDateTimeString(t,e):n.Time.fromDateString(t);},n.Time.fromJSDate=function(t,e){var i=new n.Time;return i.fromJSDate(t,e);},n.Time.fromData=function(t,e){var i=new n.Time;return i.fromData(t,e);},n.Time.now=function(){return n.Time.fromJSDate(new Date,!1);},n.Time.weekOneStarts=function(t,e){var i=n.Time.fromData({year:t,month:1,day:1,isDate:!0}),r=i.dayOfWeek(),s=e||n.Time.DEFAULT_WEEK_START;return r>n.Time.THURSDAY&&(i.day+=7),s>n.Time.THURSDAY&&(i.day-=7),i.day-=r-s,i;},n.Time.getDominicalLetter=function(o){var t='GFEDCBA',e=(o+(o/4|0)+(o/400|0)-(o/100|0)-1)%7,i=n.Time.isLeapYear(o);return i?t[(e+6)%7]+t[e]:t[e];},n.Time.epochTime=n.Time.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:'Z'}),n.Time._cmp_attr=function(t,e,i){return t[i]>e[i]?1:t[i]<e[i]?-1:0;},n.Time.daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]],n.Time.SUNDAY=1,n.Time.MONDAY=2,n.Time.TUESDAY=3,n.Time.WEDNESDAY=4,n.Time.THURSDAY=5,n.Time.FRIDAY=6,n.Time.SATURDAY=7,n.Time.DEFAULT_WEEK_START=n.Time.MONDAY;}(),function(){n.VCardTime=function(o,t,e){this.wrappedJSObject=this;var i=this._time=Object.create(null);i.year=null,i.month=null,i.day=null,i.hour=null,i.minute=null,i.second=null,this.icaltype=e||'date-and-or-time',this.fromData(o,t);},n.helpers.inherits(n.Time,n.VCardTime,{icalclass:'vcardtime',icaltype:'date-and-or-time',zone:null,clone:function(){return new n.VCardTime(this._time,this.zone,this.icaltype);},_normalize:function(){return this;},utcOffset:function(){return this.zone instanceof n.UtcOffset?this.zone.toSeconds():n.Time.prototype.utcOffset.apply(this,arguments);},toICALString:function(){return n.design.vcard.value[this.icaltype].toICAL(this.toString());},toString:function(){var t=n.helpers.pad2,e=this.year,i=this.month,r=this.day,s=this.hour,a=this.minute,u=this.second,f=e!==null,l=i!==null,m=r!==null,c=s!==null,d=a!==null,y=u!==null,v=(f?t(e)+(l||m?'-':''):l||m?'--':'')+(l?t(i):'')+(m?'-'+t(r):''),p=(c?t(s):'-')+(c&&d?':':'')+(d?t(a):'')+(!c&&!d?'-':'')+(d&&y?':':'')+(y?t(u):''),T;if(this.zone===n.Timezone.utcTimezone)T='Z';else if(this.zone instanceof n.UtcOffset)T=this.zone.toString();else if(this.zone===n.Timezone.localTimezone)T='';else if(this.zone instanceof n.Timezone){var b=n.UtcOffset.fromSeconds(this.zone.utcOffset(this));T=b.toString();}else T='';switch(this.icaltype){case'time':return p+T;case'date-and-or-time':case'date-time':return v+(p=='--'?'':'T'+p+T);case'date':return v;}return null;}}),n.VCardTime.fromDateAndOrTimeString=function(o,t){function e(v,p,T){return v?n.helpers.strictParseInt(v.substr(p,T)):null;}var i=o.split('T'),r=i[0],s=i[1],a=s?n.design.vcard.value.time._splitZone(s):[],u=a[0],f=a[1];n.helpers.strictParseInt;var l=r?r.length:0,m=f?f.length:0,c=r&&r[0]=='-'&&r[1]=='-',d=f&&f[0]=='-',y={year:c?null:e(r,0,4),month:c&&(l==4||l==7)?e(r,2,2):l==7||l==10?e(r,5,2):null,day:l==5?e(r,3,2):l==7&&c?e(r,5,2):l==10?e(r,8,2):null,hour:d?null:e(f,0,2),minute:d&&m==3?e(f,1,2):m>4?d?e(f,1,2):e(f,3,2):null,second:m==4?e(f,2,2):m==6?e(f,4,2):m==8?e(f,6,2):null};return u=='Z'?u=n.Timezone.utcTimezone:u&&u[3]==':'?u=n.UtcOffset.fromString(u):u=null,new n.VCardTime(y,u,t);};}(),function(){var o={SU:n.Time.SUNDAY,MO:n.Time.MONDAY,TU:n.Time.TUESDAY,WE:n.Time.WEDNESDAY,TH:n.Time.THURSDAY,FR:n.Time.FRIDAY,SA:n.Time.SATURDAY},t={};for(var e in o)o.hasOwnProperty(e)&&(t[o[e]]=e);n.Recur=function(m){this.wrappedJSObject=this,this.parts={},m&&typeof m=='object'&&this.fromData(m);},n.Recur.prototype={parts:null,interval:1,wkst:n.Time.MONDAY,until:null,count:null,freq:null,icalclass:'icalrecur',icaltype:'recur',iterator:function(l){return new n.RecurIterator({rule:this,dtstart:l});},clone:function(){return new n.Recur(this.toJSON());},isFinite:function(){return!!(this.count||this.until);},isByCount:function(){return!!(this.count&&!this.until);},addComponent:function(m,c){var d=m.toUpperCase();d in this.parts?this.parts[d].push(c):this.parts[d]=[c];},setComponent:function(m,c){this.parts[m.toUpperCase()]=c.slice();},getComponent:function(m){var c=m.toUpperCase();return c in this.parts?this.parts[c].slice():[];},getNextOccurrence:function(m,c){var d=this.iterator(m),y;do y=d.next();while(y&&y.compare(c)<=0);return y&&c.zone&&(y.zone=c.zone),y;},fromData:function(l){for(var m in l){var c=m.toUpperCase();c in f?Array.isArray(l[m])?this.parts[c]=l[m]:this.parts[c]=[l[m]]:this[m]=l[m];}this.interval&&typeof this.interval!='number'&&u.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!='number'&&(this.wkst=n.Recur.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof n.Time)&&(this.until=n.Time.fromString(this.until));},toJSON:function(){var l=Object.create(null);l.freq=this.freq,this.count&&(l.count=this.count),this.interval>1&&(l.interval=this.interval);for(var m in this.parts)if(this.parts.hasOwnProperty(m)){var c=this.parts[m];Array.isArray(c)&&c.length==1?l[m.toLowerCase()]=c[0]:l[m.toLowerCase()]=n.helpers.clone(this.parts[m]);}return this.until&&(l.until=this.until.toString()),'wkst'in this&&this.wkst!==n.Time.DEFAULT_WEEK_START&&(l.wkst=n.Recur.numericDayToIcalDay(this.wkst)),l;},toString:function(){var m='FREQ='+this.freq;this.count&&(m+=';COUNT='+this.count),this.interval>1&&(m+=';INTERVAL='+this.interval);for(var c in this.parts)this.parts.hasOwnProperty(c)&&(m+=';'+c+'='+this.parts[c]);return this.until&&(m+=';UNTIL='+this.until.toICALString()),'wkst'in this&&this.wkst!==n.Time.DEFAULT_WEEK_START&&(m+=';WKST='+n.Recur.numericDayToIcalDay(this.wkst)),m;}};function i(l,m,c,d){var y=d;if(d[0]==='+'&&(y=d.substr(1)),y=n.helpers.strictParseInt(y),m!==void 0&&d<m)throw new Error(l+': invalid value "'+d+'" must be > '+m);if(c!==void 0&&d>c)throw new Error(l+': invalid value "'+d+'" must be < '+m);return y;}n.Recur.icalDayToNumericDay=function(m,c){var d=c||n.Time.SUNDAY;return(o[m]-d+7)%7+1;},n.Recur.numericDayToIcalDay=function(m,c){var d=c||n.Time.SUNDAY,y=m+d-n.Time.SUNDAY;return y>7&&(y-=7),t[y];};var r=/^(SU|MO|TU|WE|TH|FR|SA)$/,s=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,a=['SECONDLY','MINUTELY','HOURLY','DAILY','WEEKLY','MONTHLY','YEARLY'],u={FREQ:function(l,m,c){if(a.indexOf(l)!==-1)m.freq=l;else throw new Error('invalid frequency "'+l+'" expected: "'+a.join(', ')+'"');},COUNT:function(l,m,c){m.count=n.helpers.strictParseInt(l);},INTERVAL:function(l,m,c){m.interval=n.helpers.strictParseInt(l),m.interval<1&&(m.interval=1);},UNTIL:function(l,m,c){l.length>10?m.until=n.design.icalendar.value['date-time'].fromICAL(l):m.until=n.design.icalendar.value.date.fromICAL(l),c||(m.until=n.Time.fromString(m.until));},WKST:function(l,m,c){if(r.test(l))m.wkst=n.Recur.icalDayToNumericDay(l);else throw new Error('invalid WKST value "'+l+'"');}},f={BYSECOND:i.bind(this,'BYSECOND',0,60),BYMINUTE:i.bind(this,'BYMINUTE',0,59),BYHOUR:i.bind(this,'BYHOUR',0,23),BYDAY:function(l){if(s.test(l))return l;throw new Error('invalid BYDAY value "'+l+'"');},BYMONTHDAY:i.bind(this,'BYMONTHDAY',-31,31),BYYEARDAY:i.bind(this,'BYYEARDAY',-366,366),BYWEEKNO:i.bind(this,'BYWEEKNO',-53,53),BYMONTH:i.bind(this,'BYMONTH',1,12),BYSETPOS:i.bind(this,'BYSETPOS',-366,366)};n.Recur.fromString=function(l){var m=n.Recur._stringToData(l,!1);return new n.Recur(m);},n.Recur.fromData=function(l){return new n.Recur(l);},n.Recur._stringToData=function(l,m){for(var c=Object.create(null),d=l.split(';'),y=d.length,v=0;v<y;v++){var p=d[v].split('='),T=p[0].toUpperCase(),b=p[0].toLowerCase(),Y=m?b:T,A=p[1];if(T in f){for(var D=A.split(','),N=0,E=D.length;N<E;N++)D[N]=f[T](D[N]);c[Y]=D.length==1?D[0]:D;}else T in u?u[T](A,c,m):c[b]=A;}return c;};}(),n.RecurIterator=function(){function o(t){this.fromData(t);}return o.prototype={completed:!1,rule:null,dtstart:null,last:null,occurrence_number:0,by_indices:null,initialized:!1,by_data:null,days:null,days_index:0,fromData:function(t){if(this.rule=n.helpers.formatClassType(t.rule,n.Recur),!this.rule)throw new Error('iterator requires a (ICAL.Recur) rule');if(this.dtstart=n.helpers.formatClassType(t.dtstart,n.Time),!this.dtstart)throw new Error('iterator requires a (ICAL.Time) dtstart');t.by_data?this.by_data=t.by_data:this.by_data=n.helpers.clone(this.rule.parts,!0),t.occurrence_number&&(this.occurrence_number=t.occurrence_number),this.days=t.days||[],t.last&&(this.last=n.helpers.formatClassType(t.last,n.Time)),this.by_indices=t.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=t.initialized||!1,this.initialized||this.init();},init:function(){this.initialized=!0,this.last=this.dtstart.clone();var e=this.by_data;if('BYDAY'in e&&this.sort_byday_rules(e.BYDAY),'BYYEARDAY'in e&&('BYMONTH'in e||'BYWEEKNO'in e||'BYMONTHDAY'in e||'BYDAY'in e))throw new Error('Invalid BYYEARDAY rule');if('BYWEEKNO'in e&&'BYMONTHDAY'in e)throw new Error('BYWEEKNO does not fit to BYMONTHDAY');if(this.rule.freq=='MONTHLY'&&('BYYEARDAY'in e||'BYWEEKNO'in e))throw new Error('For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear');if(this.rule.freq=='WEEKLY'&&('BYYEARDAY'in e||'BYMONTHDAY'in e))throw new Error('For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear');if(this.rule.freq!='YEARLY'&&'BYYEARDAY'in e)throw new Error('BYYEARDAY may only appear in YEARLY rules');if(this.last.second=this.setup_defaults('BYSECOND','SECONDLY',this.dtstart.second),this.last.minute=this.setup_defaults('BYMINUTE','MINUTELY',this.dtstart.minute),this.last.hour=this.setup_defaults('BYHOUR','HOURLY',this.dtstart.hour),this.last.day=this.setup_defaults('BYMONTHDAY','DAILY',this.dtstart.day),this.last.month=this.setup_defaults('BYMONTH','MONTHLY',this.dtstart.month),this.rule.freq=='WEEKLY')if('BYDAY'in e){var i=this.ruleDayOfWeek(e.BYDAY[0],this.rule.wkst),r=i[0],s=i[1],a=s-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<s&&a>=0||a<0)&&(this.last.day+=a);}else{var u=n.Recur.numericDayToIcalDay(this.dtstart.dayOfWeek());e.BYDAY=[u];}if(this.rule.freq=='YEARLY'){for(;this.expand_year_days(this.last.year),!(this.days.length>0);)this.increment_year(this.rule.interval);this._nextByYearDay();}if(this.rule.freq=='MONTHLY'&&this.has_by_data('BYDAY')){var f=null,l=this.last.clone(),m=n.Time.daysInMonth(this.last.month,this.last.year);for(var c in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(c)){this.last=l.clone();var i=this.ruleDayOfWeek(this.by_data.BYDAY[c]),r=i[0],s=i[1],d=this.last.nthWeekDay(s,r);if(r>=6||r<=-6)throw new Error('Malformed values in BYDAY part');if(d>m||d<=0){if(f&&f.month==l.month)continue;for(;d>m||d<=0;)this.increment_month(),m=n.Time.daysInMonth(this.last.month,this.last.year),d=this.last.nthWeekDay(s,r);}this.last.day=d,(!f||this.last.compare(f)<0)&&(f=this.last.clone());}if(this.last=f.clone(),this.has_by_data('BYMONTHDAY')&&this._byDayAndMonthDay(!0),this.last.day>m||this.last.day==0)throw new Error('Malformed values in BYDAY part');}else if(this.has_by_data('BYMONTHDAY')&&this.last.day<0){var m=n.Time.daysInMonth(this.last.month,this.last.year);this.last.day=m+this.last.day+1;}},next:function(){var e=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)return this.completed=!0,null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;var i;do switch(i=1,this.rule.freq){case'SECONDLY':this.next_second();break;case'MINUTELY':this.next_minute();break;case'HOURLY':this.next_hour();break;case'DAILY':this.next_day();break;case'WEEKLY':this.next_week();break;case'MONTHLY':i=this.next_month();break;case'YEARLY':this.next_year();break;default:return null;}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!i);if(this.last.compare(e)==0)throw new Error('Same occurrence found twice, protecting you from death by recursion');return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last);},next_second:function(){return this.next_generic('BYSECOND','SECONDLY','second','minute');},increment_second:function(e){return this.increment_generic(e,'second',60,'minute');},next_minute:function(){return this.next_generic('BYMINUTE','MINUTELY','minute','hour','next_second');},increment_minute:function(e){return this.increment_generic(e,'minute',60,'hour');},next_hour:function(){return this.next_generic('BYHOUR','HOURLY','hour','monthday','next_minute');},increment_hour:function(e){this.increment_generic(e,'hour',24,'monthday');},next_day:function(){'BYDAY'in this.by_data;var e=this.rule.freq=='DAILY';return this.next_hour()==0||(e?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0;},next_week:function(){var e=0;if(this.next_weekday_by_week()==0)return e;if(this.has_by_data('BYWEEKNO')){++this.by_indices.BYWEEKNO,this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,e=1),this.last.month=1,this.last.day=1;var i=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*i,e&&this.increment_year(1);}else this.increment_monthday(7*this.rule.interval);return e;},normalizeByMonthDayRules:function(t,e,i){for(var r=n.Time.daysInMonth(e,t),s=[],a=0,u=i.length,f;a<u;a++)if(f=i[a],!(Math.abs(f)>r)){if(f<0)f=r+(f+1);else if(f===0)continue;s.indexOf(f)===-1&&s.push(f);}return s.sort((l,m) =>{return l-m;});},_byDayAndMonthDay:function(t){var e,i=this.by_data.BYDAY,r,s=0,a,u=i.length,f=0,l,m=this,c=this.last.day;function d(){for(l=n.Time.daysInMonth(m.last.month,m.last.year),e=m.normalizeByMonthDayRules(m.last.year,m.last.month,m.by_data.BYMONTHDAY),a=e.length;e[s]<=c&&!(t&&e[s]==c)&&s<a-1;)s++;}function y(){c=0,m.increment_month(),s=0,d();}d(),t&&(c-=1);for(var v=48;!f&&v;){if(v--,r=c+1,r>l){y();continue;}var p=e[s++];if(p>=r)c=p;else{y();continue;}for(var T=0;T<u;T++){var b=this.ruleDayOfWeek(i[T]),Y=b[0],A=b[1];if(this.last.day=c,this.last.isNthWeekDay(A,Y)){f=1;break;}}if(!f&&s===a){y();continue;}}if(v<=0)throw new Error('Malformed values in BYDAY combined with BYMONTHDAY parts');return f;},next_month:function(){this.rule.freq=='MONTHLY';var e=1;if(this.next_hour()==0)return e;if(this.has_by_data('BYDAY')&&this.has_by_data('BYMONTHDAY'))e=this._byDayAndMonthDay();else if(this.has_by_data('BYDAY')){var i=n.Time.daysInMonth(this.last.month,this.last.year),r=0,s=0;if(this.has_by_data('BYSETPOS')){for(var a=this.last.day,u=1;u<=i;u++)this.last.day=u,this.is_day_in_byday(this.last)&&(s++,u<=a&&r++);this.last.day=a;}e=0;for(var u=this.last.day+1;u<=i;u++)if(this.last.day=u,this.is_day_in_byday(this.last)&&(!this.has_by_data('BYSETPOS')||this.check_set_position(++r)||this.check_set_position(r-s-1))){e=1;break;}u>i&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data('BYSETPOS')||this.check_set_position(1))&&(e=1):e=0);}else if(this.has_by_data('BYMONTHDAY')){this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month());var i=n.Time.daysInMonth(this.last.month,this.last.year),u=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];u<0&&(u=i+u+1),u>i?(this.last.day=1,e=this.is_day_in_byday(this.last)):this.last.day=u;}else{this.increment_month();var i=n.Time.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>i?e=0:this.last.day=this.by_data.BYMONTHDAY[0];}return e;},next_weekday_by_week:function(){var e=0;if(this.next_hour()==0)return e;if(!this.has_by_data('BYDAY'))return 1;for(;;){var i=new n.Time;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,e=1);var r=this.by_data.BYDAY[this.by_indices.BYDAY],s=this.ruleDayOfWeek(r),a=s[1];a-=this.rule.wkst,a<0&&(a+=7),i.year=this.last.year,i.month=this.last.month,i.day=this.last.day;var u=i.startDoyWeek(this.rule.wkst);if(!(a+u<1&&!e)){var f=n.Time.fromDayOfYear(u+a,this.last.year);return this.last.year=f.year,this.last.month=f.month,this.last.day=f.day,e;}}},next_year:function(){if(this.next_hour()==0)return 0;if(++this.days_index==this.days.length){this.days_index=0;do this.increment_year(this.rule.interval),this.expand_year_days(this.last.year);while(this.days.length==0);}return this._nextByYearDay(),1;},_nextByYearDay:function(){var e=this.days[this.days_index],i=this.last.year;e<1&&(e+=1,i+=1);var r=n.Time.fromDayOfYear(e,i);this.last.day=r.day,this.last.month=r.month;},ruleDayOfWeek:function(e,i){var r=e.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(r){var s=parseInt(r[1]||0,10);return e=n.Recur.icalDayToNumericDay(r[2],i),[s,e];}else return[0,0];},next_generic:function(e,i,r,s,a){var u=e in this.by_data,f=this.rule.freq==i,l=0;if(a&&this[a]()==0)return l;if(u){this.by_indices[e]++,this.by_indices[e];var m=this.by_data[e];this.by_indices[e]==m.length&&(this.by_indices[e]=0,l=1),this.last[r]=m[this.by_indices[e]];}else f&&this['increment_'+r](this.rule.interval);return u&&l&&f&&this['increment_'+s](1),l;},increment_monthday:function(e){for(var i=0;i<e;i++){var r=n.Time.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>r&&(this.last.day-=r,this.increment_month());}},increment_month:function(){if(this.last.day=1,this.has_by_data('BYMONTH'))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=='MONTHLY'?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;var e=n.helpers.trunc(this.last.month/12);this.last.month%=12,this.last.month++,e!=0&&this.increment_year(e);}},increment_year:function(e){this.last.year+=e;},increment_generic:function(e,i,r,s){this.last[i]+=e;var a=n.helpers.trunc(this.last[i]/r);this.last[i]%=r,a!=0&&this['increment_'+s](a);},has_by_data:function(e){return e in this.rule.parts;},expand_year_days:function(e){var i=new n.Time;this.days=[];var r={},s=['BYDAY','BYWEEKNO','BYMONTHDAY','BYMONTH','BYYEARDAY'];for(var a in s)if(s.hasOwnProperty(a)){var u=s[a];u in this.rule.parts&&(r[u]=this.rule.parts[u]);}if('BYMONTH'in r&&'BYWEEKNO'in r){var f=1,l={};i.year=e,i.isDate=!0;for(var m=0;m<this.by_data.BYMONTH.length;m++){var c=this.by_data.BYMONTH[m];i.month=c,i.day=1;var d=i.weekNumber(this.rule.wkst);i.day=n.Time.daysInMonth(c,e);var y=i.weekNumber(this.rule.wkst);for(m=d;m<y;m++)l[m]=1;}for(var v=0;v<this.by_data.BYWEEKNO.length&&f;v++){var p=this.by_data.BYWEEKNO[v];p<52?f&=l[v]:f=0;}f?delete r.BYMONTH:delete r.BYWEEKNO;}var T=Object.keys(r).length;if(T==0){var b=this.dtstart.clone();b.year=this.last.year,this.days.push(b.dayOfYear());}else if(T==1&&'BYMONTH'in r){for(var Y in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(Y)){var A=this.dtstart.clone();A.year=e,A.month=this.by_data.BYMONTH[Y],A.isDate=!0,this.days.push(A.dayOfYear());}}else if(T==1&&'BYMONTHDAY'in r){for(var D in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(D)){var N=this.dtstart.clone(),E=this.by_data.BYMONTHDAY[D];if(E<0){var C=n.Time.daysInMonth(N.month,e);E=E+C+1;}N.day=E,N.year=e,N.isDate=!0,this.days.push(N.dayOfYear());}}else if(T==2&&'BYMONTHDAY'in r&&'BYMONTH'in r){for(var Y in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(Y)){var P=this.by_data.BYMONTH[Y],C=n.Time.daysInMonth(P,e);for(var D in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(D)){var E=this.by_data.BYMONTHDAY[D];E<0&&(E=E+C+1),i.day=E,i.month=P,i.year=e,i.isDate=!0,this.days.push(i.dayOfYear());}}}else if(!(T==1&&'BYWEEKNO'in r)){if(!(T==2&&'BYWEEKNO'in r&&'BYMONTHDAY'in r))if(T==1&&'BYDAY'in r)this.days=this.days.concat(this.expand_by_day(e));else if(T==2&&'BYDAY'in r&&'BYMONTH'in r){for(var Y in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(Y)){var c=this.by_data.BYMONTH[Y],C=n.Time.daysInMonth(c,e);i.year=e,i.month=this.by_data.BYMONTH[Y],i.day=1,i.isDate=!0;var x=i.dayOfWeek(),z=i.dayOfYear()-1;i.day=C;var L=i.dayOfWeek();if(this.has_by_data('BYSETPOS')){for(var I=[],S=1;S<=C;S++)i.day=S,this.is_day_in_byday(i)&&I.push(S);for(var W=0;W<I.length;W++)(this.check_set_position(W+1)||this.check_set_position(W-I.length))&&this.days.push(z+I[W]);}else for(var M in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(M)){var h=this.by_data.BYDAY[M],g=this.ruleDayOfWeek(h),w=g[0],O=g[1],B,U=(O+7-x)%7+1,H=C-(L+7-O)%7;if(w==0)for(var S=U;S<=C;S+=7)this.days.push(z+S);else w>0?(B=U+(w-1)*7,B<=C&&this.days.push(z+B)):(B=H+(w+1)*7,B>0&&this.days.push(z+B));}}this.days.sort((G,Q) =>{return G-Q;});}else if(T==2&&'BYDAY'in r&&'BYMONTHDAY'in r){var k=this.expand_by_day(e);for(var j in k)if(k.hasOwnProperty(j)){var S=k[j],V=n.Time.fromDayOfYear(S,e);this.by_data.BYMONTHDAY.indexOf(V.day)>=0&&this.days.push(S);}}else if(T==3&&'BYDAY'in r&&'BYMONTHDAY'in r&&'BYMONTH'in r){var k=this.expand_by_day(e);for(var j in k)if(k.hasOwnProperty(j)){var S=k[j],V=n.Time.fromDayOfYear(S,e);this.by_data.BYMONTH.indexOf(V.month)>=0&&this.by_data.BYMONTHDAY.indexOf(V.day)>=0&&this.days.push(S);}}else if(T==2&&'BYDAY'in r&&'BYWEEKNO'in r){var k=this.expand_by_day(e);for(var j in k)if(k.hasOwnProperty(j)){var S=k[j],V=n.Time.fromDayOfYear(S,e),p=V.weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(p)&&this.days.push(S);}}else T==3&&'BYDAY'in r&&'BYWEEKNO'in r&&'BYMONTHDAY'in r||(T==1&&'BYYEARDAY'in r?this.days=this.days.concat(this.by_data.BYYEARDAY):this.days=[]);}return 0;},expand_by_day:function(e){var i=[],r=this.last.clone();r.year=e,r.month=1,r.day=1,r.isDate=!0;var s=r.dayOfWeek();r.month=12,r.day=31,r.isDate=!0;var a=r.dayOfWeek(),u=r.dayOfYear();for(var f in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(f)){var l=this.by_data.BYDAY[f],m=this.ruleDayOfWeek(l),c=m[0],d=m[1];if(c==0)for(var y=(d+7-s)%7+1,v=y;v<=u;v+=7)i.push(v);else if(c>0){var p;d>=s?p=d-s+1:p=d-s+8,i.push(p+(c-1)*7);}else{var T;c=-c,d<=a?T=u-a+d:T=u-a+d-7,i.push(T-(c-1)*7);}}return i;},is_day_in_byday:function(e){for(var i in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(i)){var r=this.by_data.BYDAY[i],s=this.ruleDayOfWeek(r),a=s[0],u=s[1],f=e.dayOfWeek();if(a==0&&u==f||e.nthWeekDay(u,a)==e.day)return 1;}return 0;},check_set_position:function(e){if(this.has_by_data('BYSETPOS')){var i=this.by_data.BYSETPOS.indexOf(e);return i!==-1;}return!1;},sort_byday_rules:function(e){for(var i=0;i<e.length;i++)for(var r=0;r<i;r++){var s=this.ruleDayOfWeek(e[r],this.rule.wkst)[1],a=this.ruleDayOfWeek(e[i],this.rule.wkst)[1];if(s>a){var u=e[i];e[i]=e[r],e[r]=u;}}},check_contract_restriction:function(e,i){var r=o._indexMap[e],s=o._expandMap[this.rule.freq][r],a=!1;if(e in this.by_data&&s==o.CONTRACT){var u=this.by_data[e];for(var f in u)if(u.hasOwnProperty(f)&&u[f]==i){a=!0;break;}}else a=!0;return a;},check_contracting_rules:function(){var e=this.last.dayOfWeek(),i=this.last.weekNumber(this.rule.wkst),r=this.last.dayOfYear();return this.check_contract_restriction('BYSECOND',this.last.second)&&this.check_contract_restriction('BYMINUTE',this.last.minute)&&this.check_contract_restriction('BYHOUR',this.last.hour)&&this.check_contract_restriction('BYDAY',n.Recur.numericDayToIcalDay(e))&&this.check_contract_restriction('BYWEEKNO',i)&&this.check_contract_restriction('BYMONTHDAY',this.last.day)&&this.check_contract_restriction('BYMONTH',this.last.month)&&this.check_contract_restriction('BYYEARDAY',r);},setup_defaults:function(e,i,r){var s=o._indexMap[e],a=o._expandMap[this.rule.freq][s];return a!=o.CONTRACT&&(e in this.by_data||(this.by_data[e]=[r]),this.rule.freq!=i)?this.by_data[e][0]:r;},toJSON:function(){var t=Object.create(null);return t.initialized=this.initialized,t.rule=this.rule.toJSON(),t.dtstart=this.dtstart.toJSON(),t.by_data=this.by_data,t.days=this.days,t.last=this.last.toJSON(),t.by_indices=this.by_indices,t.occurrence_number=this.occurrence_number,t;}},o._indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8},o._expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]},o.UNKNOWN=0,o.CONTRACT=1,o.EXPAND=2,o.ILLEGAL=3,o;}(),n.RecurExpansion=function(){function o(r){return n.helpers.formatClassType(r,n.Time);}function t(r,s){return r.compare(s);}function e(r){return r.hasProperty('rdate')||r.hasProperty('rrule')||r.hasProperty('recurrence-id');}function i(r){this.ruleDates=[],this.exDates=[],this.fromData(r);}return i.prototype={complete:!1,ruleIterators:null,ruleDates:null,exDates:null,ruleDateInc:0,exDateInc:0,exDate:null,ruleDate:null,dtstart:null,last:null,fromData:function(r){var s=n.helpers.formatClassType(r.dtstart,n.Time);if(s)this.dtstart=s;else throw new Error('.dtstart (ICAL.Time) must be given');if(r.component)this._init(r.component);else{if(this.last=o(r.last)||s.clone(),!r.ruleIterators)throw new Error('.ruleIterators or .component must be given');this.ruleIterators=r.ruleIterators.map((a) =>{return n.helpers.formatClassType(a,n.RecurIterator);}),this.ruleDateInc=r.ruleDateInc,this.exDateInc=r.exDateInc,r.ruleDates&&(this.ruleDates=r.ruleDates.map(o),this.ruleDate=this.ruleDates[this.ruleDateInc]),r.exDates&&(this.exDates=r.exDates.map(o),this.exDate=this.exDates[this.exDateInc]),typeof r.complete<'u'&&(this.complete=r.complete);}},next:function(){for(var r,s,a,u=500,f=0;;){if(f++>u)throw new Error('max tries have occured, rule may be impossible to forfill.');if(s=this.ruleDate,r=this._nextRecurrenceIter(this.last),!s&&!r){this.complete=!0;break;}if((!s||r&&s.compare(r.last)>0)&&(s=r.last.clone(),r.next()),this.ruleDate===s&&this._nextRuleDay(),this.last=s,this.exDate&&(a=this.exDate.compare(this.last),a<0&&this._nextExDay(),a===0)){this._nextExDay();continue;}return this.last;}},toJSON:function(){function r(a){return a.toJSON();}var s=Object.create(null);return s.ruleIterators=this.ruleIterators.map(r),this.ruleDates&&(s.ruleDates=this.ruleDates.map(r)),this.exDates&&(s.exDates=this.exDates.map(r)),s.ruleDateInc=this.ruleDateInc,s.exDateInc=this.exDateInc,s.last=this.last.toJSON(),s.dtstart=this.dtstart.toJSON(),s.complete=this.complete,s;},_extractDates:function(r,s){function a(d){c=n.helpers.binsearchInsert(u,d,t),u.splice(c,0,d);}for(var u=[],f=r.getAllProperties(s),l=f.length,m=0,c;m<l;m++)f[m].getValues().forEach(a);return u;},_init:function(r){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!e(r)){this.ruleDate=this.last.clone(),this.complete=!0;return;}if(r.hasProperty('rdate')&&(this.ruleDates=this._extractDates(r,'rdate'),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=n.helpers.binsearchInsert(this.ruleDates,this.last,t),this.ruleDate=this.ruleDates[this.ruleDateInc]),r.hasProperty('rrule'))for(var s=r.getAllProperties('rrule'),a=0,u=s.length,f,l;a<u;a++)f=s[a].getFirstValue(),l=f.iterator(this.dtstart),this.ruleIterators.push(l),l.next();r.hasProperty('exdate')&&(this.exDates=this._extractDates(r,'exdate'),this.exDateInc=n.helpers.binsearchInsert(this.exDates,this.last,t),this.exDate=this.exDates[this.exDateInc]);},_nextExDay:function(){this.exDate=this.exDates[++this.exDateInc];},_nextRuleDay:function(){this.ruleDate=this.ruleDates[++this.ruleDateInc];},_nextRecurrenceIter:function(){var r=this.ruleIterators;if(r.length===0)return null;for(var s=r.length,a,u,f=0,l;f<s;f++){if(a=r[f],u=a.last,a.completed){s--,f!==0&&f--,r.splice(f,1);continue;}(!l||l.last.compare(u)>0)&&(l=a);}return l;}},i;}(),n.Event=function(){function o(e,i){e instanceof n.Component||(i=e,e=null),e?this.component=e:this.component=new n.Component('vevent'),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],i&&i.strictExceptions&&(this.strictExceptions=i.strictExceptions),i&&i.exceptions?i.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents('vevent').forEach(function(r){r.hasProperty('recurrence-id')&&this.relateException(r);},this);}o.prototype={THISANDFUTURE:'THISANDFUTURE',exceptions:null,strictExceptions:!1,relateException:function(e){if(this.isRecurrenceException())throw new Error('cannot relate exception to exceptions');if(e instanceof n.Component&&(e=new n.Event(e)),this.strictExceptions&&e.uid!==this.uid)throw new Error('attempted to relate unrelated exception');var i=e.recurrenceId.toString();if(this.exceptions[i]=e,e.modifiesFuture()){var r=[e.recurrenceId.toUnixTime(),i],s=n.helpers.binsearchInsert(this.rangeExceptions,r,t);this.rangeExceptions.splice(s,0,r);}},modifiesFuture:function(){if(!this.component.hasProperty('recurrence-id'))return!1;var e=this.component.getFirstProperty('recurrence-id').getParameter('range');return e===this.THISANDFUTURE;},findRangeException:function(e){if(!this.rangeExceptions.length)return null;var i=e.toUnixTime(),r=n.helpers.binsearchInsert(this.rangeExceptions,[i],t);if(r-=1,r<0)return null;var s=this.rangeExceptions[r];return i<s[0]?null:s[1];},getOccurrenceDetails:function(e){var i=e.toString(),r=e.convertToZone(n.Timezone.utcTimezone).toString(),s,a={recurrenceId:e};if(i in this.exceptions)s=a.item=this.exceptions[i],a.startDate=s.startDate,a.endDate=s.endDate,a.item=s;else if(r in this.exceptions)s=this.exceptions[r],a.startDate=s.startDate,a.endDate=s.endDate,a.item=s;else{var u=this.findRangeException(e),f;if(u){var l=this.exceptions[u];a.item=l;var m=this._rangeExceptionCache[u];if(!m){var c=l.recurrenceId.clone(),d=l.startDate.clone();c.zone=d.zone,m=d.subtractDate(c),this._rangeExceptionCache[u]=m;}var y=e.clone();y.zone=l.startDate.zone,y.addDuration(m),f=y.clone(),f.addDuration(l.duration),a.startDate=y,a.endDate=f;}else f=e.clone(),f.addDuration(this.duration),a.endDate=f,a.startDate=e,a.item=this;}return a;},iterator:function(e){return new n.RecurExpansion({component:this.component,dtstart:e||this.startDate});},isRecurring:function(){var e=this.component;return e.hasProperty('rrule')||e.hasProperty('rdate');},isRecurrenceException:function(){return this.component.hasProperty('recurrence-id');},getRecurrenceTypes:function(){for(var e=this.component.getAllProperties('rrule'),i=0,r=e.length,s=Object.create(null);i<r;i++){var a=e[i].getFirstValue();s[a.freq]=!0;}return s;},get uid(){return this._firstProp('uid');},set uid(e){this._setProp('uid',e);},get startDate(){return this._firstProp('dtstart');},set startDate(e){this._setTime('dtstart',e);},get endDate(){var e=this._firstProp('dtend');if(!e){var i=this._firstProp('duration');e=this.startDate.clone(),i?e.addDuration(i):e.isDate&&(e.day+=1);}return e;},set endDate(e){this.component.hasProperty('duration')&&this.component.removeProperty('duration'),this._setTime('dtend',e);},get duration(){var e=this._firstProp('duration');return e||this.endDate.subtractDateTz(this.startDate);},set duration(e){this.component.hasProperty('dtend')&&this.component.removeProperty('dtend'),this._setProp('duration',e);},get location(){return this._firstProp('location');},set location(e){return this._setProp('location',e);},get attendees(){return this.component.getAllProperties('attendee');},get summary(){return this._firstProp('summary');},set summary(e){this._setProp('summary',e);},get description(){return this._firstProp('description');},set description(e){this._setProp('description',e);},get color(){return this._firstProp('color');},set color(e){this._setProp('color',e);},get organizer(){return this._firstProp('organizer');},set organizer(e){this._setProp('organizer',e);},get sequence(){return this._firstProp('sequence');},set sequence(e){this._setProp('sequence',e);},get recurrenceId(){return this._firstProp('recurrence-id');},set recurrenceId(e){this._setTime('recurrence-id',e);},_setTime:function(e,i){var r=this.component.getFirstProperty(e);r||(r=new n.Property(e),this.component.addProperty(r)),i.zone===n.Timezone.localTimezone||i.zone===n.Timezone.utcTimezone?r.removeParameter('tzid'):r.setParameter('tzid',i.zone.tzid),r.setValue(i);},_setProp:function(e,i){this.component.updatePropertyWithValue(e,i);},_firstProp:function(e){return this.component.getFirstPropertyValue(e);},toString:function(){return this.component.toString();}};function t(e,i){return e[0]>i[0]?1:i[0]>e[0]?-1:0;}return o;}(),n.ComponentParser=function(){function o(t){typeof t>'u'&&(t={});var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);}return o.prototype={parseEvent:!0,parseTimezone:!0,oncomplete:function(){},onerror:function(t){},ontimezone:function(t){},onevent:function(t){},process:function(t){typeof t=='string'&&(t=n.parse(t)),t instanceof n.Component||(t=new n.Component(t));for(var e=t.getAllSubcomponents(),i=0,r=e.length,s;i<r;i++)switch(s=e[i],s.name){case'vtimezone':if(this.parseTimezone){var a=s.getFirstPropertyValue('tzid');a&&this.ontimezone(new n.Timezone({tzid:a,component:s}));}break;case'vevent':this.parseEvent&&this.onevent(new n.Event(s));break;default:continue;}this.oncomplete();}},o;}();})(X);var se=X.exports,K=ne(se);const ae=_=>_.end?_.start.getHours()===0&&_.start.getMinutes()===0&&_.end.getHours()===0&&_.end.getMinutes()===0:!1,oe=(_,n,o=1)=>{const t=structuredClone(_);return n===R.Daily?new Date(t.setDate(t.getDate()+o)):n===R.Weekly?new Date(t.setDate(t.getDate()+o*7)):n===R.Monthly?new Date(t.setMonth(t.getMonth()+o)):n===R.Yearly?new Date(t.setFullYear(t.getFullYear()+o)):t;},ue=async(_,n)=>{fetch(ie.calendar.syncProxyServer+_,{method:'GET',redirect:'follow'}).then(async o=>{const t=K.parse(await o.text()),e=new K.Component(t),i=[];e.getAllSubcomponents('vevent').forEach(r=>{const s=new K.Event(r),a='eventCalendar-'+s.uid;i.push(a);const u=s.component.getFirstPropertyValue('last-modified').toJSDate();if(n&&u<n)return;const f={_id:a,title:s.summary,description:s.description,created:ee(),type:Z.Event,readonly:!0,parent:_,members:[],events:[],alarms:[],aboveActivities:[],belowActivities:[]},l={id:'activityEvent'+s.uid,start:s.startDate.toJSDate(),end:s.endDate.toJSDate()};if(l.allDay=ae(l),l.allDay&&l.end&&(l.end=J(l.end,-1)),s.isRecurring()){const m=s.component.getFirstPropertyValue('rrule');if(m.freq)switch(m.freq){case'DAILY':l.repeat=R.Daily;break;case'WEEKLY':l.repeat=R.Weekly;break;case'MONTHLY':l.repeat=R.Monthly;break;case'YEARLY':l.repeat=R.Yearly;break;default:l.repeat=R.NoRepeat;}m.until?l.repeatEnd=m.until.toJSDate():m.count&&(l.repeatEnd=J(oe(l.start,l.repeat,m.count),-1)),m.interval&&(l.repeatInterval=m.interval??1),m?.parts?.BYDAY&&(l.repeatDays=m.parts.BYDAY.map(c=>{switch(c){case'MO':return 1;case'TU':return 2;case'WE':return 3;case'TH':return 4;case'FR':return 5;case'SA':return 6;case'SU':return 0;default:return 0;}}));}f.events=[l],s.component.getAllSubcomponents('valarm').forEach(m=>{const d=new K.Event(m).component.getFirstPropertyValue('trigger');(d.weeks||d.days||d.hours||d.minutes||d.seconds)&&f.alarms.push({weeks:d.weeks??0,days:d.days??0,hours:d.hours??0,minutes:d.minutes??0,seconds:d.seconds??0,isNegative:d.isNegative??!1});}),re('Adding activity',f),postMessage({type:'calendar-sync',activity:f});}),postMessage({type:'calendar-sync-all-ids',eventIds:i,calendarUrl:_});});};onmessage=_=>{const{calendarUrl:n,lastCalendarSync:o}=JSON.parse(_.data);ue(n,new Date(o));};
